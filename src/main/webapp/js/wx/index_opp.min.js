function build_word_unit(e,t,o){console.log("build_word_unit");var i=e.entity.records[o].id,a=e.entity.records[o].opportunityName,n=$('<div class="boxSizing opportunityList">'+a+"</div>");n.attr("value",i),n.bind("click",function(){local_set(i,a,3),location.href=apppath+"/wx/opportunity/detail.action?"+ddcommparams+"&opportunityId="+i}),t.append(n)}function wordScrollFunc(){$("#search_content").bind("scroll",function(){$("#load_more").length>0&&$("#search_content .main").offset().top<=$(window).height()-$("#search_content .main").height()+3&&($("#load_more.end_info").remove(),$("#search_content .main").append($('<div id="loading" class="end_info">加载中…</div>')),build_common_list(apppath+"/wx/opportunity/dolist.action",$("#search_content .main"),"无相关商机",build_word_unit,wordScrollFunc))})}function build_list_unit(e,t,o){var i=e.entity.records[o],a=i.saleStageText,n=i.opportunityName,r=i.money,s=i.accountName,l=i.id,d=i.saleStageOrder,c=i.saleStagePercentage,p=$('<li class="boxSizing"><em class="icon jieduan'+d+'"></em><div class="info"><div class="top"><span class="opportunityName">'+n+'</span><span class="Money">'+r+'元</span></div><div class="bot"><p class="accountName">'+s+'</p><p class="jieduan">阶段：'+a+'</p><span class="jieduan_p">'+c+"%</span></div></div></li>");p.attr("id",l),p.attr("name",n),p.bind("click",function(){local_set($(this).attr("id"),$(this).attr("name"),3),location.href=apppath+"/wx/opportunity/detail.action?"+ddcommparams+"&opportunityId="+$(this).attr("id")+"&from=opp_list"}),t.append(p)}function local_set(e,t,o){if(1==o||2==o){var i={id:e,name:t,kindle:o};if(localStorage.getItem(userId)){var a=JSON.parse(localStorage.getItem(userId));if(a.accountHistory){for(var n=0;n<a.accountHistory.length;n++)a.accountHistory[n].id==e&&a.accountHistory.remove(n);a.accountHistory.push(i)}else var a={accountHistory:[i]}}else var a={accountHistory:[i]}}else if(3==o){var i={id:e,name:t};if("undefined"!=localStorage.getItem(userId)){var a=JSON.parse(localStorage.getItem(userId));if(a.opportunityHistory){for(var n=0;n<a.opportunityHistory.length;n++)a.opportunityHistory[n].id==e&&a.opportunityHistory.remove(n);a.opportunityHistory.push(i)}else var a={opportunityHistory:[i]}}else var a={opportunityHistory:[i]}}localStorage.setItem(userId,JSON.stringify(a))}function loaded(){myScroll=new IScroll("#content",{probeType:3,mouseWheel:!0,preventDefault:!1,scrollbars:!0,momentum:!0,useTransform:!1,click:!0,tap:!0,bounceTime:200,mouseWheelSpeed:200}),myScroll.on("scrollStart",function(){$("#load_more.end_info").length>0&&($("#load_more.end_info").remove(),$("#list .main").append($('<div id="loading" class="end_info">加载中…</div>')),build_common_list(apppath+"/wx/opportunity/dolist.action",$("#list .main"),empty,build_list_unit,loaded))}),myScroll.on("scrollEnd",function(){$("#loading").remove()})}function build_common_list(e,t,o,i,a){$(window).scrollTop(0),$.ajax({url:e,data:obj,dataType:"json",success:function(e){if($(".load-shadow").hide(),1==e.success){var n,r=e.entity.totalSize;if(0==r){t.children().remove();var s=$('<div class="list">'+o+"</div>");s.css({width:"100%",lineHeight:"90px",fontSize:"30px",textAlign:"center"}),t.append(s)}else{n=r-pageNo*pageSize>pageSize?pageSize:r-pageNo*pageSize;for(var l=0;n>l;l++)i(e,t,l);t.children().length<r&&t.append($('<div id="load_more" class="end_info">加载更多</div>')),obj.pageNo++,pageNo++,$("#loading").remove(),a()}}else e.entity&&e.entity.status&&"0000003"==e.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:myAlert("网络不给力，请重新加载")},error:function(){myAlert("网络不给力，请重新加载")}})}$(function(){build_common_list(apppath+"/wx/opportunity/dolist.action?d="+ +new Date,$("#list .main"),empty,build_list_unit,loaded)});var empty='<div class="content-reminder"><div class="ico"><p>暂无数据</p></div></div>',saleStageId=0,closeType=0,min=0,max=0,pageNo=0,pageSize=20,orderField="saleStageId, updatedAt desc",searchDateType=GetQueryString("searchDateType"),obj={pageNo:pageNo,pagesize:pageSize,orderField:orderField,searchDateType:searchDateType},userId=xsyUser.id,myScroll;