function back(){""==$("#textarea").val()&&""==$("input").val()?location.href=apppath+"/wx/serveice/index.action?"+ddcommparams:0==$(".chooseShadow").length?myChoose(apppath+"/wx/serveice/index.action?"+ddcommparams):$(".chooseShadow").remove()}function confirm(){$("#send").on("touchstart",function(){$(this).addClass("touching")}),$("#send").on("touchend",function(){$(this).removeClass("touching")}),$("#send").on("click",function(){rtn_reg($("#textarea"),reg_opinion)&&rtn_reg($(".contactWay input"),reg_tel)?$.ajax({url:apppath+"/wx/feedback/add.action",data:{content:$("#textarea").val(),contactWay:$(".contactWay input").val(),device:device},beforeSend:function(){$(this).attr("disabled",!0),loader()},dataType:"json",success:function(t){if($(".loaderArea").remove(),1==t.success){myDialog("提交成功"),time_out_location(apppath+"/wx/serveice/index.action?"+ddcommparams)}else"0000002"==t.entity.status?(myAlert("提交失败，不能包含表情符"),$button.removeAttr("disabled")):t.entity&&t.entity.status&&"0000003"==t.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:(myAlert("提交失败"),$(this).removeAttr("disabled"))},error:function(){$(".loaderArea").remove(),myAlert("网络不给力，请重新加载","without"),$(this).removeAttr("disabled")}}):(""==$("#textarea").val()&&myAlert("请填写反馈内容"),confirm_reg($(".contactWay input"),reg_tel,"联系方式格式错误"))})}function confirm_reg(t,e,a){e.test(t.val())||add_warn(t,a)}function add_warn(t,e){t.addClass("warn");var a=$('<div class="warning"><span>'+e+"</span></div>");t.parent().css({marginBottom:"74px"}),t.parent().append(a),t.on("click",function(){remove_warn(t)})}function remove_warn(t){t.removeClass("warn"),t.parent().css({marginBottom:"0px"}),t.parent().find(".warning").remove()}function textarea_num(){$("#num").text($("#textarea").val().length+"/300"),$("#textarea").on("input",function(){$(this).val().length>300&&$(this).val($(this).val().substr(0,300)),$("#num").text($(this).val().length+"/300")})}$(document).on("ready",function(){textarea_num(),confirm();var t=xsyUser.phone;""!=t&&$(".contactWay .value").attr("value",t)});var reg_opinion=/^.{1,300}$/,reg_tel=/^[a-zA-Z0-9@.]{0,200}$/,device=3,u=navigator.userAgent,isAndroid=u.indexOf("Android")>-1||u.indexOf("Adr")>-1,isiOS=!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);isAndroid?device=2:isiOS&&(device=1);