function execRn(){var e=$(".picker-calendar-year-picker .current-year-value").text(),a=$(".picker-calendar-month-picker .current-month-value").text();$(".shcedule-year").text(e),$(".shcedule-month").text(a),initpicker()}function getScduleinfo(e,a,t,c){$.ajax({type:"get",url:apppath+"/wx/schedule/dolist.action?d="+ +new Date,data:{startTime:e,endTime:a,type:t},async:!0,dataType:"json",success:function(e){if(0==e.success)myAlert("网络不给力，请重新加载");else{console.log(e);var a=e.entity.records;$.each(a,function(e,a){if(0==a.count)if("screen"==c){$(".schedule-body").children().remove();var t=$('<div class="schedule-list-null"> <p>无相关内容</p></div>');$(".schedule-body").append(t),addschdule()}else{$(".schedule-body").children().remove();var t=$('<div class="schedule-list-null"> <p>今天没有日程哦</p><a href="javascript:;" class="index-add-schdule">马上添加</a></div>');$(".schedule-body").append(t),addschdule()}else createScduleList(a.list)})}}})}function initpicker(){var e=$(".picker-calendar-month-current").find(".picker-calendar-row").first().find(".picker-calendar-day").first(),a=$(".picker-calendar-month-current").find(".picker-calendar-row").last().find(".picker-calendar-day").last(),t=e.attr("data-year"),c=Number(e.attr("data-month"))+1,s=e.attr("data-day"),d=t+"-"+Appendzero(c)+"-"+Appendzero(s),i=a.attr("data-year"),l=Number(a.attr("data-month"))+1,n=a.attr("data-day"),r=i+"-"+Appendzero(l)+"-"+Appendzero(n);$.ajax({type:"get",url:apppath+"/wx/schedule/dolist.action",data:{startTime:d,endTime:r},async:!0,dataType:"json",success:function(e){if(0==e.success)myAlert("网络不给力，请重新加载");else{console.log(e),scheduleData=e;var a=e.entity.records;$.each(a,function(e,a){if("0"==a.count);else{var t=e,c=t.split("-"),s=$(".shcedule-datepicker-body").find('[data-year="'+c[0]+'"][data-month="'+(Number(c[1])-1)+'"][data-day="'+Number(c[2])+'"]'),d=$('<i class="circle"></i>');s.find("span").append(d)}})}var t=$("#date3").val();getlistSchduleInfo(t)}})}function getlistSchduleInfo(e,a){console.log(scheduleData);var t=scheduleData.entity.records;$.each(t,function(t,c){if(t==e)if(0==c.count)if("screen"==a){$(".schedule-body").children().remove();var s=$('<div class="schedule-list-null"> <p>无相关内容</p></div>');$(".schedule-body").append(s),addschdule()}else{$(".schedule-body").children().remove();var s=$('<div class="schedule-list-null"> <p>今天没有日程哦</p><a href="javascript:;" class="index-add-schdule">马上添加</a></div>');$(".schedule-body").append(s),addschdule()}else createScduleList(c.list)})}function pickerSelect(){}function createScduleList(e){$(".schedule-body").children().remove();for(var a=$('<div class="schedule-item"></div>'),t=0,c=e.length;c>t;t++){var s=e[t].startDate.substring(11,16),d=e[t].endDate.substring(11,16),i=e[t].status,l=$('<div class="schedule-cell" id='+e[t].id+"></div>"),n=$('<div class="schedule-item-time"><span class="schedule-time-start">'+s+'</span><span class="schedule-time-line">-</span><span class="schedule-time-end">'+d+"</span></div>"),r=$('<div class="schedule-item-title">'+e[t].name+"</div>"),o=$('<div class="schedule-item-operate"><a href="javascript:;" class="schedule-item-accept">接受</a><a href="javascript:;" class="schedule-item-refuse">拒绝</a></div>');l.append(n),l.append(r),"1"==i&&l.append(o),"2"==i&&l.append(o),a.append(l)}if($(".schedule-body").append(a),$(".schedule-item .schedule-cell").on("click",function(){var e=$(this).attr("id");location.href=apppath+"/wx/schedule/info.action?"+ddcommparams+"&from=schdule_list&id="+e}),"reject"==GetQueryString("reject")){var u=GetQueryString("id");$(".schedule-item #"+u).remove()}schduleAccept(),scheduleReject()}function screen(){$(".load-shadow").show(),$(".shcedule-filter").on("click",function(){if($(this).hasClass("active"))$("#shcedule_screen_area").show();else if($(this).addClass("active"),$("#shcedule_screen_area").length>0)$("#shcedule_screen_area").show();else{var e=$('<div id="shcedule_screen_area"  class="boxSizing"></div>'),a=$('<div class="stage_screen"><div class="title boxSizing">日程类型</div><div class="con"></div></div>'),t=$('<div class="footer"><a href="javascript:;" class="confirm">确定</a> <a href="javascript:;" class="reset">重置</a></div>');e.append(a),e.append(t),$("body").append(e),$.ajax({url:apppath+"/wx/schedule/getDetail.action",dataType:"json",data:{scene:"DETAIL"},success:function(e){if($(".load-shadow").hide(),1==e.success){for(var a=e.entity.structure.components,t=a.length,c=0;t>c;c++)"type"==a[c].propertyname&&(shceduleTypelist=a[c].selectItem);for(var c=0,s=shceduleTypelist.length;s>c;c++){var d=$('<div class="stage_item item boxSizing"><span>'+shceduleTypelist[c].label+"</span></div>");d.attr("id",shceduleTypelist[c].value),d.bind("click",function(){$(this).hasClass("active")?$(this).removeClass("active"):($(this).addClass("active"),$(this).siblings().removeClass("active"),shceduleTypeId=Number($(this).attr("id")))}),$(".stage_screen .con").append(d)}}}})}$(".reset").bind("click",function(){$(".item").removeClass("active");var e=$("#date3").val();getlistSchduleInfo(e)}),$(".confirm").unbind("click"),$(".confirm").bind("click",function(){var e=$("#shcedule_screen_area .con").find(".active").length;0>=e&&$(".shcedule-filter").removeClass("active");var a=$(".stage_item.active").attr("id"),t=$("#date3").val();$("#shcedule_screen_area").hide();var c="screen";getScduleinfo(t,t,a,c)})})}function addschdule(){$(".index-add-schdule").on("click",function(){selectFlag?location.href=apppath+"/wx/schedule/add.action?"+ddcommparams+"&from=schedule_list&type=add&data="+selectDate:location.href=apppath+"/wx/schedule/add.action?"+ddcommparams+"&from=schedule_list&type=add"})}function schduleAccept(){$(".schedule-item-accept").on("click",function(e){var a=$(this).closest(".schedule-cell").attr("id");e.stopPropagation(),acceptReceipt(a,$(this))})}function acceptReceipt(e,a){$.ajax({url:apppath+"/wx/schedule/doaccept.action",data:{id:e},dataType:"json",success:function(e){1==e.success&&(a.hide(),a.siblings().hide())}})}function scheduleReject(){$(".schedule-item-refuse").on("click",function(e){var a=$(this).closest(".schedule-cell").attr("id");e.stopPropagation(),rejectReceipt(a,$(this))})}function rejectReceipt(e,a){$.ajax({url:apppath+"/wx/schedule/doreject.action",data:{id:e},dataType:"json",success:function(e){1==e.success&&(a.hide(),a.siblings().hide(),a.closest(".schedule-cell").remove())}})}var haveOpen=!1,index_=1,scheduleData,selectDate,selectFlag;$(document).ready(function(){$("#inline-calendar").calendar({container:"#inline-calendar",input:"#date3",onOpen:function(e){var a=$(".picker-calendar-year-picker .current-year-value").text(),t=$(".picker-calendar-month-picker .current-month-value").text();$(".shcedule-year").text(a),$(".shcedule-month").text(t),haveOpen=!0},onMonthAdd:function(){haveOpen&&execRn()},onDayClick:function(e,a,t,c,s){var d=t,i=parseInt(c)+1,l=s;selectDate=d+"-"+Appendzero(i)+"-"+Appendzero(l),$(".shcedule-filter").removeClass("active"),getScduleinfo(selectDate,selectDate),selectFlag=!0}}),screen(),$(".shcedule-add").on("click",function(){console.log(selectDate),selectFlag?location.href=apppath+"/wx/schedule/add.action?"+ddcommparams+"&from=schedule_list&type=add&data="+selectDate:location.href=apppath+"/wx/schedule/add.action?"+ddcommparams+"&from=schedule_list&type=add"}),$(".shcedule-return").on("click",function(){window.location.reload()}),initpicker(),window.addEventListener("popstate",function(e){console.log(e.state),"1"!=e.state&&null!=e.state||($("#shcedule_screen_area").hide(),$(".shcedule-filter").removeClass("active"));var a=$("#shcedule_screen_area");null==e.state&&0==a.length||"1"==e.state&&0==a.length}),null==event.state?history.pushState("1","ceshi title",window.location.href):history.pushState("2","ceshi title",window.location.href)});var shceduleTypelist={},shceduleTypeId;