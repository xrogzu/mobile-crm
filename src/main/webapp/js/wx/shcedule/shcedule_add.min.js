function getShcduleDetail(e){$.ajax({url:apppath+"/wx/schedule/getDetail.action",dataType:"json",data:{scene:e},type:"GET",beforeSend:function(){},success:function(e){if(0==e.success&&myAlert("网络不给力，请重新加载"),1==e.success){var t=e.entity.structure.components,a=t.length;$("#shcedule_parter_select").html(xsyuser),$("#shcedule_parter_select").attr("value",xsyid),$("#shcedule_frequency_select").html("不重复"),$("#shcedule_frequency_select").attr("value","0");for(var c=0;a>c;c++)"type"==t[c].propertyname&&(shceduleTypelist=t[c].selectItem,$("#shcedule_type_select").html(shceduleTypelist[0].label),$("#shcedule_type_select").attr("value",shceduleTypelist[0].value),getShceduleType(shceduleTypelist)),"frequency"==t[c].propertyname&&(scheduleFrequencylist=t[c].selectItem,getShceduleFrequency(scheduleFrequencylist)),"belongId"==t[c].propertyname&&(shceduleBelongidList=t[c].selectItem,getShcedulebelongId(shceduleBelongidList)),"recurStopCondition"==t[c].propertyname&&(shcedulerecurStopList=t[c].selectItem,getShcedulerecurStop(shcedulerecurStopList));getShceduleMember(),$("textarea").autoHeight(),textarea_num()}}})}function getCurrentDate(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,c=e.getDate(),n=e.getHours(),i=e.getMinutes(),r=e.getSeconds();datestring=t+String(10>a?"0"+a:a)+String(10>c?"0"+c:c)+String(10>n?"0"+n:n)+String(10>i?"0"+i:i)+String(10>r?"0"+r:r);var s=datestring.substring(0,4),l=datestring.substring(4,6),o=datestring.substring(6,8),d=s+"-"+l+"-"+o,u=datestring.substring(8,10),p=datestring.substring(10,12),h=u+":"+p,m=Number(u)+1,v=m+":"+p,_=GetQueryString("data");null==_?($("#startDay").text(d),$("#startMinutes").text(h),$("#endDay").text(d),$("#endMinutes").text(v),startData=d+" "+h,endData=d+" "+v):($("#startDay").text(_),$("#startMinutes").text(h),$("#endDay").text(_),$("#endMinutes").text(v),startData=d+" "+h,endData=d+" "+v)}function checkIsPrivate(){var e=$('input[name="shcedule_is_private"]');1==e.is(":checked")&&(isPrivate=!0),0==e.is(":checked")&&(isPrivate=!1)}function shceduleDateSelect(){$("#datetime-picker-start").change(function(){if(startdataFirstSelectFlag){var e=GetQueryString("data"),t=$("#datetime-picker-start").val(),a=t.substring(11,16),c=t.substring(0,10);null==e?$("#startDay").html(c):$("#startDay").html(e),$("#startMinutes").html(a),startdataFirstSelectFlag=!1}else{var t=$("#datetime-picker-start").val(),a=t.substring(11,16),c=t.substring(0,10);$("#startDay").html(c),$("#startMinutes").html(a)}}),$("#datetime-picker-end").change(function(){if(enddataFirstSelectFlag){var e=GetQueryString("data"),t=$("#datetime-picker-end").val(),a=t.substring(0,10),c=t.substring(11,16);null==e?$("#endDay").html(a):($("#endDay").html(e),$("#datetime-picker-end").val(e)),$("#endMinutes").html(c),enddataFirstSelectFlag=!1}else{var t=$("#datetime-picker-end").val(),a=t.substring(0,10),c=t.substring(11,16);$("#endDay").html(a),$("#endMinutes").html(c)}})}function shceduleCheckTime(){var e,t,a=$("#datetime-picker-start").val(),c=$("#datetime-picker-end").val();if(""==a){var n=$("#startDay").text(),i=$("#startMinutes").text();startDayTime=n+" "+i,t=$.myTime.DateToUnix(startDayTime)}else t=$.myTime.DateToUnix(a);if(""==c){var r=$("#endDay").text(),s=$("#endMinutes").text(),l=r+" "+s;e=$.myTime.DateToUnix(l)}else e=$.myTime.DateToUnix(c);return!(t>=e)}function getShceduleType(e){$("#shcedule_type_select").on("click",function(){$(this).addClass("active");var t=$("#shcedule_type_select");checkTable("选择类型"),createShcduleList(e,t)})}function getShceduleFrequency(e){$("#shcedule_frequency_select").on("click",function(){$(this).addClass("active");var t=$("#shcedule_frequency_select");checkTable("设置重复"),createShcduleList(e,t)})}function getShcedulebelongId(e){$("#shcedule_belongid_select").on("click",function(){$(this).addClass("active");var t=$("#shcedule_belongid_select");checkTable("设置重复"),createBelongidList(e,t)})}function getShcedulerecurStop(e){$("#shcedule_end_select").on("click",function(){$(this).addClass("active");var t=$("#shcedule_end_select");checkTable("结束条件"),createShcduleList(e,t)})}function createShcduleList(e,t){for(var a=$('<div class="container"></div>'),c=0,n=e.length;n>c;c++){var i=$('<div class="item boxSizing"><em class="radio"><i></i></em><span>'+e[c].label+"</span></div>");i.attr("value",e[c].value),a.append(i)}$(".ct").append(a),a.find('.item[value="'+$(t).attr("value")+'"] em').addClass("active"),$(".ct .item").on("click",function(){$(this).find("em").addClass("active"),$(this).siblings().find("em").removeClass("active");var a=$(this).index(),c=e[a].label,n=e[a].value;$("#shcedule_frequency_select");if($(t).html(c),$(t).attr("value",n),"shcedule_frequency_select"==$(t).attr("id"))if("1"==n||"2"==n||"3"==n){$("#shcedule_end_item").show();var i=$("#shcedule_end_select");i.html("永不结束"),i.attr("value","1"),i.addClass("active"),isRecur=!0}else $("#shcedule_end_item").hide(),$("#shcedule_end_time").hide();else"shcedule_end_select"==$(t).attr("id")&&("2"==n?$("#shcedule_end_time").show():"1"==n&&$("#shcedule_end_time").hide());$(".ct").remove(),$("body").css({overflow:"",height:"auto"})})}function createBelongidList(e,t){for(var a=$('<div class="container belongid-container"></div>'),c=0,n=e.length;n>c;c++){var i=$('<div class="item boxSizing"><span>'+e[c].label+'</span><i class="shcedule-right-arrow"></i></div>');i.attr("value",e[c].value),a.append(i)}$(".ct").append(a),$(".ct .item").on("click",function(){$(".shcedule-search-warp").show();var e=$(this).attr("value");$("#shcedule_belongid_select").attr("objectId",e);var t=$(".ipt_area").find("input");switch(e){case"1":t.attr("placeholder","搜索公司"),t.attr("data-entity","account");break;case"2":t.attr("placeholder","搜索联系人"),t.attr("data-entity","contact");break;case"3":t.attr("placeholder","搜索商机"),t.attr("data-entity","opp")}})}function searchInputDelete(){""==$(".ipt_area").find("input").val()?$(".ipt_area").find(".delete_icon").hide():$(".ipt_area").find(".delete_icon").show(),$(".ipt_area").find(".delete_icon").on("click",function(){$(this).hide(),$(".ipt_area").find("input").val(""),$("#content>.list").remove(),$(".dialog").remove(),show_history()})}function back(){$("#back").on("click",function(){$("#txt").attr("value",""),$(".shcedule-search-warp").find("#content").children().remove(),$(".shcedule-search-warp").hide()})}function getShceduleMember(){$("#shcedule_parter_select").on("click",function(){btn_color_adjust(),getShceduleMemberlist()})}function getShceduleMemberlist(){$.ajax({type:"get",url:apppath+"/wx/xsyuser/pager.action",async:!0,dataType:"json",success:function(e){if($(".load-shadow").hide(),0==e.success)myAlert("网络不给力，请重新加载");else if(1==e.entity.records.length){var t=$('<div class="no_contact">您的公司下暂时没有其他员工</div>');$("body").append(t),setTimeout(function(){$(".no_contact").remove()},2e3)}else{checkTable("添加成员"),$(".ct").addClass("multiple");var a=$('<div id="container" class="container"></div>');$(".ct").append(a);var c=$("#shcedule_parter_select");checkboxDummyList(a,e,c)}}})}function checkboxDummyList(e,t,a){for(var c=0,n=t.entity.records.length;n>c;c++){var i=t.entity.records[c].id,r=t.entity.records[c].name,s=$('<div class="item boxSizing" id = "'+i+'" atext = "'+r+'"><em class="checkbox"></em><span>'+r+"</span></div>");s.attr("value",i),e.append(s)}var l=$(a).attr("value");""!=l&&(checkboxMember=l.split(","));for(var o=0;o<checkboxMember.length;o++)for(var c=0,n=t.entity.records.length;n>c;c++){var i=$(".ct .item").eq(c).attr("id");$.trim(checkboxMember[o])==i&&$(".ct .item").eq(c).find("em").addClass("active")}checkboxClick(t),createConfirm(t,a)}function checkboxClick(e){$(".item").each(function(e){$(this).bind("click",function(){checkboxChange=!0,$(this).find("em").hasClass("active")?$(this).find("em").removeClass("active"):$(this).find("em").addClass("active")})})}function createConfirm(e,t){var a=$('<button id="confirm" class="confirm">确定</button>');$(".ct").append(a),a.bind("touchstart",function(){$(this).addClass("touching")}),a.bind("touchend",function(){$(this).removeClass("touching")}),a.bind("click",function(){$("#container .item").each(function(){$(this).find("em").hasClass("active")&&-1==$.inArray($(this).attr("value"),arr_value)&&(arr_value.push($(this).attr("value")),arr_label.push($(this).attr("atext")+",")),$(t).attr("value",arr_value),$(t).html(arr_label),$(t).attr("class","active"),$(".ct").remove(),$("body").css({overflow:"auto",height:"auto"})})})}function confirm(){function e(e){checkIsPrivate();if(""==$(".shcedule-header-titile input").val())return confirm_reg($(".shcedule-header-titile"),"日程主题不能为空"),void $(window).scrollTop(0);if(0==shceduleCheckTime())return confirm_reg($(".shcedule-add-timepicker-right"),"结束时间要晚于开始时间"),void $(window).scrollTop(0);if(""==$("#shcedule_parter_select").val()||"点击选择"==$("#shcedule_parter_select").val())return confirm_reg($("#shcedule_parter_select"),"参与人不能为空"),void $(window).scrollTop(0);var t=$("#shcedule_end_select").attr("value"),a=$("#datetime").val();return"2"==t&&""==a?(confirm_reg($("#datetime"),"结束日期不能为空"),void $(window).scrollTop(0)):void shceduleAddInfo()}$("#shcedule_add_confirm").bind("click",function(){e()})}function shceduleAddInfo(e){var t="";if("set"==GetQueryString("type")){t=apppath+"/wx/schedule/doupdate.action";var a=$("#startDay").text(),c=$("#startMinutes").text(),n=a+" "+c,i=$("#endDay").text(),r=$("#endMinutes").text(),s=i+" "+r,l=[],o=$("#shcedule_frequency_select").attr("value");if(0!=o)var d=!0;l=$("#shcedule_parter_select").attr("value").split(",");var u=$("#datetime").val(),p={name:$(".shcedule-header-titile input").val(),type:$("#shcedule_type_select").attr("value"),startDate:""==$("#datetime-picker-start").val()?n:$("#datetime-picker-start").val(),endDate:""==$("#datetime-picker-end").val()?s:$("#datetime-picker-end").val(),isPrivate:isPrivate,reminder:-1,members:0==member_value.length?[h]:l,description:$("#comment textarea").val(),objectId:$("#shcedule_belongid_select").attr("value"),belongId:$("#shcedule_belongid_select").attr("objectId"),recurStopCondition:$("#shcedule_end_select").attr("value"),recurStopValue:u,frequency:$("#shcedule_frequency_select").attr("value"),isRecur:d,id:GetQueryString("id")}}else{t=apppath+"/wx/schedule/docreate.action";var a=$("#startDay").text(),c=$("#startMinutes").text(),n=a+" "+c,i=$("#endDay").text(),r=$("#endMinutes").text(),s=i+" "+r,h=[];h=$("#shcedule_parter_select").attr("value");var u=$("#datetime").val(),p={name:$(".shcedule-header-titile input").val(),type:$("#shcedule_type_select").attr("value"),startDate:""==$("#datetime-picker-start").val()?n:$("#datetime-picker-start").val(),endDate:""==$("#datetime-picker-end").val()?s:$("#datetime-picker-end").val(),isPrivate:isPrivate,reminder:-1,members:0==arr_value.length?[h]:arr_value,description:$("#comment textarea").val(),objectId:$("#shcedule_belongid_select").attr("value"),belongId:$("#shcedule_belongid_select").attr("objectId"),recurStopCondition:$("#shcedule_end_select").attr("value"),recurStopValue:u,isRecur:isRecur,frequency:$("#shcedule_frequency_select").attr("value")}}$.ajax({type:"post",url:t,data:{scheduleStr:JSON.stringify(p)},async:!0,beforeSend:function(){$(".confirm").attr("disabled","true"),loader()},dataType:"json",success:function(e){if($(".loaderArea").remove(),1==e.success){if(myDialog("保存成功"),"set"==GetQueryString("type"))var t=GetQueryString("id");else var t=e.entity.id;setTimeout(function(){location.replace(apppath+"/wx/schedule/list.action?"+ddcommparams+"&type=add&id="+t+"&startDate="+p.startDate+"&endDate="+p.endDate)},2e3)}else 0==e.success&&($(".confirm").removeAttr("disabled"),myAlert("保存失败，请检查输入信息"))},error:function(){$(".loaderArea").remove(),$(".confirm").removeAttr("disabled"),myAlert("暂时无法获取数据，请检查您的网络")}})}function scheduleSetInfo(){$.ajax({url:apppath+"/wx/schedule/getDetail.action",data:{id:GetQueryString("id"),scene:"UPDATE"},dataType:"json",success:function(e){$(".shcedule-header-titile input").val(e.entity.data.name);var t=e.entity.data.type;""==t?$("#shcedule_type_select").html("选择类型"):($("#shcedule_type_select").html(e.entity.expandPro.typeText),$("#shcedule_type_select").attr("value",e.entity.data.type)),btn_color_adjust();var a=e.entity.data.startDate,c=e.entity.data.endDate,n=a.substring(0,10),i=a.substring(11,16),r=c.substring(0,10),s=c.substring(11,16);$("#startDay").html(n),$("#startMinutes").html(i),$("#endDay").html(r),$("#endMinutes").html(s);var l=e.entity.expandPro.members;"0"==l.length?$("#shcedule_parter_select").html("点击选择"):($.each(l,function(e,t){member_value.push(t.id),member_label.push(t.name+",")}),$("#shcedule_parter_select").attr("value",member_value),$("#shcedule_parter_select").html(member_label));var o=e.entity.data.objectId,d=e.entity.data.belongId,u=e.entity.expandPro.objectIdText;""==d?$("#shcedule_belongid_select").html("点击选择"):($("#shcedule_belongid_select").addClass("active"),$("#shcedule_belongid_select").attr("value",o),$("#shcedule_belongid_select").attr("objectid",d),$("#shcedule_belongid_select").html(u));var p=e.entity.data.isPrivate,h=$('input[name="shcedule_is_private"]');1==p?h.attr("checked",!0):h.attr("checked",!1);var m=e.entity.data.isRecur,v=e.entity.data.recurStopCondition,_=e.entity.expandPro.recurStopConditionText,g=e.entity.data.recurStopValue;if(1==m&&"1"==v&&($("#shcedule_end_item").show(),$("#shcedule_end_select").addClass("active"),$("#shcedule_end_select").attr("value",v),$("#shcedule_end_select").html(_)),1==m&&"2"==v){$("#shcedule_end_item").show(),$("#shcedule_end_time").show(),$("#shcedule_end_select").addClass("active"),$("#shcedule_end_select").attr("value",v),$("#shcedule_end_select").html(_);var y=g.substring(0,10);$("#datetime").val(y)}var f=e.entity.data.frequency;$("#shcedule_frequency_select").attr("value",f),$("#shcedule_frequency_select").html(e.entity.expandPro.frequencyText);var b=e.entity.data.description;""==b?$("#comment textarea").val("描述"):$("#comment textarea").val(e.entity.data.description),$("textarea").autoHeight(),textarea_num()}})}function list_top(){$(window).on("scroll",function(){var e=$("#acc_area").offset().top-$(document).scrollTop();88>=e?($("#account_top").css({position:"fixed",top:"88px"}),$("#acc_area").css({paddingTop:$("#account_top").height()+"px"})):($("#account_top").css({position:"static"}),$("#acc_area").css({paddingTop:"0px"}));var t=$("#con_area").offset().top-$(document).scrollTop();t<=88+$("#account_top").height()?$("#account_top").css({position:"absolute",top:$("#con_area").offset().top-$("#account_top").height()-1+"px"}):$("#account_top").css({top:"88px"}),88>=t?($("#contact_top").css({position:"fixed",top:"88px"}),$("#con_area").css({paddingTop:$("#contact_top").height()+"px"})):($("#contact_top").css({position:"static"}),$("#con_area").css({paddingTop:"0px"}))})}function search(){$("#txt").on("input",function(){input_search()})}function input_search(){searchInputDelete(),val=$("#txt").val()," "==val.substr(0,1)&&(val=val.trim()),""==val?($(".list").remove(),$(".dialog").remove()):show_word(val)}function show_history(){if($("#content").children().remove(),"undefined"!=localStorage.getItem(userId)){var e=JSON.parse(localStorage.getItem(userId));e.accountHistory&&0!=e.accountHistory.length?create_history_list(e):create_history_null()}else create_history_null()}function create_history_list(e){if(e.accountHistory.length<=20){for(var t=e.accountHistory.length-1;t>=0;t--)build_history_list(e,t);create_delete()}else{for(var t=e.accountHistory.length-1;t>=e.accountHistory.length-20;t--)build_history_list(e,t);create_delete()}}function build_history_list(e,t){var a=document.createElement("div");a.className="boxSizing history_list";var c=e.accountHistory[t].name,n=e.accountHistory[t].id,i=e.accountHistory[t].kindle;1==i?($(a).append($('<em class="account_pic"></em>')),$(a).on("click",function(){location.href=apppath+"/wx/account/info.action?"+ddcommparams+"&accountId="+n})):($(a).append($('<em class="contact_pic"></em>')),$(a).on("click",function(){location.href=apppath+"/wx/contact/info.action?"+ddcommparams+"&contactId="+n})),$(a).append($('<span class="name">'+c+"</span>"));var r=document.createElement("div");r.innerHTML='<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NDA5MDMwNDRCMkU5MTFFNUE4MDNFMkU5NkI5N0FEOEMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NDA5MDMwNDVCMkU5MTFFNUE4MDNFMkU5NkI5N0FEOEMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMTRGRjgyMUIyRTUxMUU1QTgwM0UyRTk2Qjk3QUQ4QyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMTRGRjgyMkIyRTUxMUU1QTgwM0UyRTk2Qjk3QUQ4QyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Prom4REAAADHSURBVHjanNVNCoMwEAXgydAb9CJ21QvYVb2uK91rwUUPYs9gZ2ACIeTnJQNv48gHCQ91+3ZsROQkb8mP+uYumSUXG/aULLbowVYznIKT5Ct5dKAeG8yYFDwlrwBdQTTG1DjZliE6AGgS0wUHL6FoFotBBC1iKbCEVjGdW+aOPLoEKNWwEphCqYbljhzOBT6DwPjOoEpxQ8+gnnJDz6CecktpEZRbSoug3IhVUe7Aiijbl9ZjI4jl0Nkf+WNYzy/Ao2rQX4ABAORFZTtFQ9/RAAAAAElFTkSuQmCC"/>',r.className="exit",$(r).on("click",function(){e.accountHistory.remove(t),localStorage.setItem(userId,JSON.stringify(e)),$(a).remove(),0==$("#content").find(".history_list").length&&($("#content > .clear").remove(),create_history_null())}),a.appendChild(r),a.href=n,$("#content").append(a)}function create_delete(){var e=document.createElement("div");e.innerHTML="清除全部历史记录",e.className="clear",e.onclick=function(){var e=JSON.parse(localStorage.getItem(userId));e.accountHistory=[],localStorage.setItem(userId,JSON.stringify(e)),$("#content > .history_list").remove(),$("#content > .clear").remove(),create_history_null()},$("#content").append(e)}function create_history_null(){var e=document.createElement("div");e.innerHTML="暂无历史记录",e.className="null",$("#content").append(e)}function show_word(e){$("#content").children().remove();var t=$("#txt").attr("data-entity");"account"==t&&create_accword_list(e),"contact"==t&&create_conword_list(e),"opp"==t&&create_oppword_list(e)}function create_accword_list(e){$.ajax({type:"get",url:apppath+"/wx/account/dolist.action",async:!0,data:{searchName:e,pageNo:0,pagesize:pageSize},dataType:"json",success:function(e){0==e.success?myAlert("网络不给力，请重新加载"):($(".dialog").remove(),build_accword_list(e))},error:function(){myAlert("网络不给力，请重新加载")}})}function create_conword_list(e){$.ajax({type:"get",url:apppath+"/wx/contact/dolist.action",async:!0,data:{searchName:e,pageNo:0,pagesize:pageSize},dataType:"json",success:function(e){0==e.success?myAlert("网络不给力，请重新加载"):($(".dialog").remove(),build_conword_list(e))},error:function(){myAlert("网络不给力，请重新加载")}})}function create_oppword_list(e){$.ajax({type:"get",url:apppath+"/wx/opportunity/dolist.action",async:!0,data:{opportunityName:e,pageNo:0,pagesize:pageSize},dataType:"json",success:function(e){0==e.success?myAlert("网络不给力，请重新加载"):($(".dialog").remove(),build_oppword_list(e))},error:function(){myAlert("网络不给力，请重新加载")}})}function build_accword_list(e){$("#content>.list").remove(),accLength=e.entity.totalSize;e.entity.records.length;if(accLength>0)var t=$('<div id="acc_area" class="boxSizing"></div>');if($("#acc_area").length>0&&$("#acc_area").remove(),$("#content").append(t),create_acc_list(0,accLength,e),0==accLength){$("#content>.list").remove();var a=document.createElement("div");a.style.cssText="width:100%;padding-left:10px;line-height:88px;font-size:30px;text-align:center;",a.className="list",a.innerHTML="无相关客户",$("#content").append(a)}}function build_conword_list(e){$("#content>.list").remove(),conLength=e.entity.totalSize;e.entity.records.length;if(conLength>0)var t=$('<div id="con_area" class="boxSizing"></div>');if($("#con_area").length>0&&$("#con_area").remove(),$("#content").append(t),create_con_list(0,conLength,e),0==conLength){$("#content>.list").remove();var a=document.createElement("div");a.style.cssText="width:100%;padding-left:10px;line-height:88px;font-size:30px;text-align:center;",a.className="list",a.innerHTML="无相关联系人",$("#content").append(a)}}function build_oppword_list(e){$("#content>.list").remove(),conLength=e.entity.totalSize;var t=e.entity.records.length;if(conLength>0)var a=$('<div id="opp_area" class="boxSizing"></div>');if($("#opp_area").length>0&&$("#opp_area").remove(),$("#content").append(a),create_opp_list(0,t,e),0==t){$("#content>.list").remove();var c=document.createElement("div");c.style.cssText="width:100%;padding-left:10px;line-height:88px;font-size:30px;text-align:center;",c.className="list",c.innerHTML="无相关商机",$("#content").append(c)}}function create_acc_list(e,t,a){if(null!=a){var c=a;build_acc_list(e,t,c)}else $.ajax({type:"get",url:apppath+"/wx/account/dolist.action",async:!0,data:{searchName:val,pageNo:acc_pageNo,pagesize:pageSize},dataType:"json",success:function(a){0==a.entity.accounts.success||0==a.entity.contacts.success?myAlert("网络不给力，请重新加载"):($(".dialog").remove(),build_acc_list(e,t,a))},error:function(){myAlert("网络不给力，请重新加载")}})}function getBelongIdText(e,t){var a=$("#shcedule_belongid_select");a.attr("value",e),a.html(t),$("#txt").attr("value",""),$(".shcedule-search-warp").find("#content").children().remove(),$(".shcedule-search-warp").hide(),$(".ct").remove(),$("body").css({overflow:"",height:"auto"})}function build_acc_list(e,t,a){t>a.entity.records.length&&(t=a.entity.records.length);for(var c=e;t>c;c++){var n=document.createElement("div"),i=a.entity.records[c].accountName,r=a.entity.records[c].accountName,s=new RegExp(val,"g"),l=a.entity.records[c].id;n.href=l,n.name=i,i=i.replace(s,"<span class='blue'>"+val+"</span>"),n.innerHTML=i,n.className="boxSizing word_list",n.accountName=r,n.addEventListener("click",function(){local_set(this.href,this.name,1),getBelongIdText(this.href,this.accountName)}),$("#acc_area").append(n)}}function create_con_list(e,t,a){if(null!=a){var c=a;build_con_list(e,t,c)}else $.ajax({type:"get",url:apppath+"/wx/contact/dolist.action",async:!0,data:{searchName:val,pageNo:con_pageNo,pagesize:pageSize},dataType:"json",success:function(a){0==a.success?myAlert("网络不给力，请重新加载"):($(".dialog").remove(),build_con_list(e,t,a))},error:function(){myAlert("网络不给力，请重新加载")}})}function build_con_list(e,t,a){t>a.entity.records.length&&(t=a.entity.records.length);for(var c=e;t>c;c++){var n=document.createElement("div"),i=a.entity.records[c].contactName,r=a.entity.records[c].contactName,s=new RegExp(val,"g");i=i.replace(s,"<span class='blue'>"+val+"</span>");var l=a.entity.records[c].id;n.innerHTML=i,n.className="boxSizing word_list",n.href=l,n.name=i,n.accountName=r,n.addEventListener("click",function(){local_set(this.href,this.name,2),getBelongIdText(this.href,this.accountName)}),$("#con_area").append(n)}}function create_opp_list(e,t,a){if(null!=a){var c=a;build_opp_list(e,t,c)}else $.ajax({type:"get",url:apppath+"/wx/opportunity/dolist.action",async:!0,data:{opportunityName:val,pageNo:opp_pageNo,pagesize:pageSize},dataType:"json",success:function(a){0==a.success?myAlert("网络不给力，请重新加载"):($(".dialog").remove(),build_opp_list(e,t,a))},error:function(){myAlert("网络不给力，请重新加载")}})}function build_opp_list(e,t,a){t>a.entity.records.length&&(t=a.entity.records.length);for(var c=e;t>c;c++){var n=document.createElement("div"),i=a.entity.records[c].opportunityName,r=a.entity.records[c].opportunityName,s=new RegExp(val,"g");i=i.replace(s,"<span class='blue'>"+val+"</span>");var l=a.entity.records[c].id;n.innerHTML=i,n.className="boxSizing word_list",n.href=l,n.name=i,n.opportunityName=r,n.addEventListener("click",function(){local_set(this.href,this.name,3),getBelongIdText(this.href,this.opportunityName)}),$("#opp_area").append(n)}}function local_set(e,t,a){if(1==a||2==a||3==a){var c={id:e,name:t,kindle:a};if(localStorage.getItem(userId)){var n=JSON.parse(localStorage.getItem(userId));if(n.accountHistory){for(var i=0;i<n.accountHistory.length;i++)n.accountHistory[i].id==e&&n.accountHistory.remove(i);n.accountHistory.push(c)}else n.accountHistory=[c]}else var n={accountHistory:[c]}}else if(3==a){var c={id:e,name:t};if(localStorage.getItem(userId)){for(var n=JSON.parse(localStorage.getItem(userId)),i=0;i<n.accountHistory.length;i++)n.accountHistory[i].id==e&&n.accountHistory.remove(i);n.accountHistory.push(c)}else var n={accountHistory:[c]}}localStorage.setItem(userId,JSON.stringify(n))}$(document).on("ready",function(){$(".shcedule-detail-header-right").on("click",function(){$(".options").toggle()}),"add"==GetQueryString("type")?(getShcduleDetail("ADD"),getCurrentDate()):"set"==GetQueryString("type")&&(document.title="编辑日程",getShcduleDetail("DETAIL"),scheduleSetInfo());var e=GetQueryString("data");if(e){var t=$("#startMinutes").text();console.log(t);var a=e+" "+t;$("#datetime-picker-start").val(a);var c=$("#endMinutes").text(),n=e+" "+c;$("#datetime-picker-end").val(n)}$("#datetime-picker-start").datetimePicker(),$("#datetime-picker-end").datetimePicker(),shceduleDateSelect(),confirm(),searchInputDelete(),search(),back(),selectDate(),btn_color_adjust(),remove_rTop(),$("textarea").autoHeight(),textarea_num()});var xsyuser=xsyUser.name,xsyid=xsyUser.id,shceduleNameValue,shceduleStyleValue,shceduleStartTimeValue,shceduleEndTimeValue,shceduleTypelist={},scheduleFrequencylist={},shceduleBelongidList={},shcedulerecurStopList={},datestring,startData,endData,isPrivate,startdataFirstSelectFlag=!0,enddataFirstSelectFlag=!0,isRecur=!1,checkboxMember={},checkboxChange=!1,arr_value=[],arr_label=[],ownerId=xsyUser.id,member_value=[],member_label=[],val=null,acc_pageNo=0,con_pageNo=0,opp_pageNo=0,pageSize=30,oData,accLength,conLength,oppLength,userId=xsyUser.id;