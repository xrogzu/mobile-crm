function tabChange(){var e=$(".schedule-item").find(".schedule-cell"),t=$("#sort").find(".behavior").hasClass("active");e.length<5&&t}function setLocalStorage(){localStorage.getItem(xsyUser.id)||localStorage.setItem(xsyUser.id,JSON.stringify({index:{rankData:"",funnelData:"",oppData:"",scheduleDate:"",workreportDate:""},opportunityHistory:"",accountHistory:""}))}function back(){$(".ct").length>0&&($(".ct").remove(),set_title("首页"),$("body").css({height:"",overflow:""}))}function sort(){if("behavior"==GetQueryString("page")){actLoad||(actLoad=!0),$("#sort .behavior").addClass("active"),$("#sort .performance").removeClass("active")}$("#sort .behavior").bind("click",function(){$(window).scrollTop(0),$(this).hasClass("active")||(actLoad||(actLoad=!0),$(".swiper-wrapper").css("-webkit-transition-duration","0ms"),$(".swiper-wrapper").css("-webkit-transform","translate3d(0px, 0px, 0px)"),$(".swiper-wrapper").css("transition-duration","0ms"),$(".swiper-wrapper").css("transform","translate3d(0px, 0px, 0px)"),$(this).addClass("active"),$("#sort .performance").removeClass("active"),tabChange(),$("#behaviorPage").addClass("swiper-slide-active"),$("#performancePage").removeClass("swiper-slide-active"))}),$("#sort .performance").bind("click",function(){if(!$(this).hasClass("active")){$(this).addClass("active");var e=-Number(indexWidth)+"px";$(".swiper-wrapper").css("-webkit-transition-duration","0ms"),$(".swiper-wrapper").css("-webkit-transform","translate3d("+e+", 0px, 0px)"),$(".swiper-wrapper").css("transition-duration","0ms"),$(".swiper-wrapper").css("transform","translate3d("+e+", 0px, 0px)"),$("#sort .behavior").removeClass("active"),tabChange(),$("#performancePage").addClass("swiper-slide-active"),$("#behaviorPage").removeClass("swiper-slide-active")}})}function selectors(){$(".selector").bind("click",function(e){"block"==$(this).find(".options").css("display")?$(this).find(".options").hide():($(".options").hide(),$(this).find(".options").show(),$(this).offset().top-$(window).scrollTop()-60>$(this).find(".options").height()?($(this).find(".options").addClass("upper"),$(this).find(".options").removeClass("lower")):($(this).find(".options").addClass("lower"),$(this).find(".options").removeClass("upper"))),e.stopPropagation()}),$(".options li").each(function(){$(this).bind("click",function(e){$(this).parent().parent().find("span").text($(this).text()),$(this).parent().hide(),e.stopPropagation()})}),$(document).on("touchstart",function(e){$(e.target).closest(".selector").size()||$(".options").hide()}),$(document).on("click",function(e){$(e.target).closest(".selector").size()||$(".options").hide()})}function get_funnel(){function e(){$.ajax({url:apppath+"/wx/char/salesfunnel.action",data:{searchDateType:funnelDateType},dataType:"json",success:function(e){if($("#performancePage .load-shadow").hide(),1==e.success){if(4==funnelDateType){var t;localStorage.getItem(xsyUser.id)&&"undefined"!=localStorage.getItem(xsyUser.id)?(t=JSON.parse(localStorage.getItem(xsyUser.id)),t.index={funnelData:e}):t={index:{funnelData:e}},localStorage.setItem(xsyUser.id,JSON.stringify(t))}funnelByData(e)}else e.entity&&e.entity.status&&"0000003"==e.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:myAlert("网络不给力，请重新加载")},error:function(){myAlert("网络不给力，请重新加载")}})}if(4==funnelDateType&&localStorage.getItem(xsyUser.id)&&"undefined"!=localStorage.getItem(xsyUser.id)){var t=JSON.parse(localStorage.getItem(xsyUser.id));t.index&&t.index.funnelData&&1==t.index.funnelData.success&&funnelByData(t.index.funnelData)}$(".funnelTop .selector .options li").each(function(){$(this).bind("click",function(){funnelDateType=$(this).attr("value"),e()})}),e()}function funnelByData(e){var t=e.entity.total,a=e.entity.win,n=e.entity.estimateCompleted,i=999999,s="元",o="元",r="元";t>i&&(t/=1e4,t=Math.round(100*t)/100,s="万元"),a>i&&(a/=1e4,a=Math.round(100*a)/100,o="万元"),n>i&&(n/=1e4,n=Math.round(100*n)/100,r="万元"),$(".whole .value").text(t),$(".predict .value").text(n),$(".actual .value").text(a),$(".whole .label").text("漏斗总值("+s+")"),$(".predict .label").text("预计完成("+r+")"),$(".actual .label").text("实际完成("+o+")");var c=e.entity.series;if(0==c[0].count&&0==c[1].count&&0==c[2].count&&0==c[3].count)$(".noDataFunnel").show(),$(".funnelArea").hide(),$("#aim").hide(),$("#saleFunnel > .title").hide(),$("#saleFunnel").addClass("noData");else if($(".funnelArea").show(),$("#aim").show(),$("#saleFunnel > .title").show(),$(".noDataFunnel").hide(),$("#saleFunnel").removeClass("noData"),"金额"==$(".funnelTop .btn").text()){var l=c[0].amount,d=c[1].amount,p=c[2].amount,u=c[3].amount,h="元";(l>i||d>i||p>i||u>i)&&(h="(万元)",l/=1e4,l=Math.round(100*l)/100,d/=1e4,d=Math.round(100*d)/100,p/=1e4,p=Math.round(100*p)/100,u/=1e4,u=Math.round(100*u)/100),$("#leftLine .line1 .info").text(c[0].name),$("#rightLine .line1 .info").text(l+h),$("#leftLine .line2 .info").text(c[1].name),$("#rightLine .line2 .info").text(d+h),$("#leftLine .line3 .info").text(c[2].name),$("#rightLine .line3 .info").text(p+h),$("#leftLine .line4 .info").text(c[3].name),$("#rightLine .line4 .info").text(u+h),funnel(c[0].amount,c[1].amount,c[2].amount,c[3].amount)}else"个数"==$(".funnelTop .btn").text()&&($("#leftLine .line1 .info").text(c[0].name),$("#rightLine .line1 .info").text(c[0].count),$("#leftLine .line2 .info").text(c[1].name),$("#rightLine .line2 .info").text(c[1].count),$("#leftLine .line3 .info").text(c[2].name),$("#rightLine .line3 .info").text(c[2].count),$("#leftLine .line4 .info").text(c[3].name),$("#rightLine .line4 .info").text(c[3].count),funnel(c[0].count,c[1].count,c[2].count,c[3].count))}function change_funnel(){$(".funnelTop .btn").bind("click",function(){"个数"==$(this).text()?($(this).text("金额"),$(this).parent().find("span").text("(元)")):"金额"==$(this).text()&&($(this).text("个数"),$(this).parent().find("span").text("(个)")),get_funnel()})}function funnel(e,t,a,n){var i=35,s=$("#funnel").height(),o=s/(e+t+a+n)*n,r=s/(e+t+a+n)*a,c=s/(e+t+a+n)*t,l=s/(e+t+a+n)*e;i>o&&(o=i),i>r&&(r=i),i>c&&(c=i),i>l&&(l=i);var d=r/8*4,p=c/8*4,u=l/8*4,h=$("#funnel .funnel4").width(),f=h,m=f+2*d,g=m+2*p;$("#funnel .funnel4").css({borderTopWidth:o}),$("#funnel .funnel3").css({borderTopWidth:r,width:f,borderLeftWidth:d,borderRightWidth:d}),$("#funnel .funnel2").css({borderTopWidth:c,width:m,borderLeftWidth:p,borderRightWidth:p}),$("#funnel .funnel1").css({borderTopWidth:l,width:g,borderLeftWidth:u,borderRightWidth:u});var v=$(".line").height(),y=$("#funnel .funnel1").position().top+parseInt($("#funnel .funnel1").css("borderTopWidth"))-v-2,x=$("#funnel .funnel2").position().top+.8*parseInt($("#funnel .funnel2").css("borderTopWidth"))-v-2,w=$("#funnel .funnel3").position().top+.8*parseInt($("#funnel .funnel3").css("borderTopWidth"))-v-2,b=$("#funnel .funnel4").position().top+parseInt($("#funnel .funnel4").css("borderTopWidth"))-v-2;v>b-w&&(w=b-v-2),v>w-x&&(x=w-v-2),v>x-y&&(y=x-v-2);var S=($("#saleFunnel").width()-$("#funnel .funnel1").width())/2-80,k=($("#saleFunnel").width()-$("#funnel .funnel2").width()-p)/2-70,_=($("#saleFunnel").width()-$("#funnel .funnel3").width()-d)/2-70,D=($("#saleFunnel").width()-$("#funnel .funnel4").width())/2-70;$("#leftLine .line1").css({top:y-15,width:S}),$("#leftLine .line2").css({top:x-5,width:k}),$("#leftLine .line3").css({top:w,width:_}),$("#leftLine .line4").css({top:b-2,width:D}),$("#rightLine .line1").css({top:y-15,width:S}),$("#rightLine .line2").css({top:x-5,width:k}),$("#rightLine .line3").css({top:w,width:_}),$("#rightLine .line4").css({top:b-2,width:D})}function actSumSelect(){$(".load-shadow").show(),$(".actSum .selector .options li").each(function(){$(this).bind("click",function(){actDateType=$(this).attr("value"),followSum()})})}function followSum(){$(".actSum .list").children().remove(),$.ajax({url:apppath+"/wx/statics/activerecords.action",data:{searchDateType:actDateType},dataType:"json",success:function(e){$("#performancePage .load-shadow").hide(),console.log("跟进汇总："+e),1==e.success?actSumByData(e):e.entity&&e.entity.status&&"0000003"==e.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:console.log("网络不给力，请重新加载")},error:function(){myAlert("网络不给力，请重新加载")}})}function actSumByData(e){function t(){var e=$('<li class="boxSizing"> <em class="'+s+'"></em> <div> <span class="name">'+r+'</span> <span class="num">'+c+o+'</span> </div> <span class="count">'+l+"</span> </li>");1*l>0?e.find(".count").addClass("more"):0>1*l&&e.find(".count").addClass("less"),$(".actSum > ul").append(e)}for(var a=e.entity,n=0,i=a.length;i>n;n++){var s,o,r=a[n].text,c=a[n].count,l=(a[n].compare,a[n].count);"新建商机"==r?(r="新增商机",o="个",s="shangji",t()):"新建客户"==r?(r="新增公司",o="个",s="gongsi",t()):"电话"==r?(o="个",s="dianhua",t()):"拜访签到"==r?(r="签到",o="次",s="qiandao",t()):"记录"==r&&(o="个",s="jilu",t())}}function get_rank(){if($(".load-shadow").show(),localStorage.getItem(xsyUser.id)){var e=JSON.parse(localStorage.getItem(xsyUser.id));e.index&&e.index.rankData&&1==e.index.rankData.success&&ranking(e.index.rankData)}$(".ranking .options li").each(function(){$(this).bind("click",function(){1==$(this).index()&&(rankDateType=4,$(".ranking .selector > span").text("本月")),2==$(this).index()&&(rankDateType=3,$(".ranking .selector > span").text("上月")),3==$(this).index()&&(rankDateType=7,$(".ranking .selector > span").text("本季")),4==$(this).index()&&(rankDateType=6,$(".ranking .selector > span").text("上季")),5==$(this).index()&&(rankDateType=10,$(".ranking .selector > span").text("本年")),6==$(this).index()&&(rankDateType=9,$(".ranking .selector > span").text("上年")),$(".ranking .list").children().remove(),$(".ranking .searchMore").remove(),get_rank_data(rankDateType)})})}function get_rank_data(e){console.log("rankDateType:"+e),$.ajax({url:apppath+"/wx/char/salesRank.action",data:{searchDateType:e},dataType:"json",success:function(t){if($("#performancePage .load-shadow").hide(),1==t.success){if(4==e){var a;localStorage.getItem(xsyUser.id)?(a=JSON.parse(localStorage.getItem(xsyUser.id)),a.index={rankData:t}):a={index:{rankData:t}},localStorage.setItem(xsyUser.id,JSON.stringify(a))}ranking(t),1==flag&&$(".ranking span.count").html(t.entity.totalCount)}else t.entity&&t.entity.status&&"0000003"==t.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:myAlert("网络不给力，请重新加载")},error:function(){myAlert("网络不给力，请重新加载")}})}function ranking(e){function t(t,a){t.children().remove();for(var n=0;a>n;n++){var i=Number(e.entity.series[n].ord)+1;10>i&&(i="0"+String(i));var s=e.entity.series[n].userName,o=e.entity.series[n].money,r=$('<li> <span class="label">'+i+'</span> <span class="name">'+s+'</span> <p class="pillowBlock"><span class="pillow"></span></p> <span class="value">'+o+"</span> </li>"),c=e.entity.series[n].userId;xsyUser?xsyUser.id==c&&r.addClass("myself"):myAlert("未获取到当前用户"),t.append(r)}var l=t.find("li").width()-t.find("li").eq(0).find(".value").width()-190;t.find(".pillowBlock").css("width",l);for(var n=0;a>n;n++){var d=l/e.entity.series[0].money*e.entity.series[n].money;0>=d&&(d=0),t.find("li").eq(n).find(".pillow").css("width",d)}}console.log(e),0==e.entity.series.length||0==e.entity.series[0].money?($("#ranking .list").hide(),$("#ranking .noDataRanking").show()):($("#ranking .list").show(),$("#ranking .noDataRanking").hide());var a=10;e.entity.series.length<=10&&(a=e.entity.series.length),t($("#ranking .list"),a),$(".ct").length>0&&t($(".ct .list"),e.entity.series.length),e.entity.series.length>10&&($("#ranking .searchMore").remove(),$("#ranking").append('<div class="searchMore">查看全部</div>'),$(".searchMore").bind("click",function(){flag=!0,checkTable("业绩排名"),$(".ct").addClass("ranking");var a=$('<div class="title boxSizing"><p class="label">业绩总值</p><p class="value"><span class="count">'+e.entity.totalCount+"</span><span>元</span></p></div>"),n=$('<div class="selector"> <span>本月</span> <ul class="options lower boxSizing"> <div class="triangle"></div> <li class="boxSizing">本月</li> <li class="boxSizing">上月</li> <li class="boxSizing">本季</li> <li class="boxSizing">上季</li> <li class="boxSizing">本年</li> <li class="boxSizing">上年</li> </ul> </div>');n.find("span").eq(0).text($("#ranking .selector >span").text()),a.append(n),n.bind("click",function(){return"block"==$(this).find(".options").css("display")?$(this).find(".options").hide():$(this).find(".options").show(),!1});var i=$('<ul class="list boxSizing"></ul>');$(".ct").append(a),$(".ct").append(i),t($(".ct .list"),e.entity.series.length),get_rank()}))}function recordSelect(){$(".load-shadow").show(),$("#recordList .selector .options li").each(function(){$(this).bind("click",function(){recordDateType=$(this).attr("value"),recordPageNo=0,$("#recordList > .main").children().remove(),get_record($("#recordList > .main"),20)})})}function get_record(e){$.ajax({url:apppath+"/wx/statics/activerecordlist.action",data:{pagesize:20,pageNo:recordPageNo,searchDateType:recordDateType},dataType:"json",success:function(t){$("#behaviorPage .load-shadow").hide(),console.log("跟进记录："+t),1==t.success?recordByData(t,e):($("#behaviorPage .load-shadow").hide(),t.entity&&t.entity.status&&"0000003"==t.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:(myAlert("网络不给力，请重新加载"),console.log("跟进记录："+t)))},error:function(){myAlert("网络不给力，请重新加载")}})}function recordByData(e,t){var a=e.entity.totalSize;$("#recordList > .top > .title > span").text("跟进记录("+a+")"),0==e.entity.records.length?(t.append($('<div class="noInfo">该范围内没有跟进记录</div>')),console.log("该对象暂无跟进记录")):(build_record_list(t,e),t.find("li").length<a?($("#loading").remove(),build_end(t,"加载更多","load_more"),recordPageNo++,scroll_load()):$("#loading").remove())}function build_end(e,t,a){var n=$('<div id="'+a+'" class="end_info">'+t+"</div>");e.append(n)}function scroll_load(){var e=document.body.clientHeight;$(window).bind("scroll",function(){$("#load_more").length>0&&$("#load_more").offset().top-$(document).scrollTop()<=e-$("#load_more").height()-50&&($("#load_more").remove(),build_end($("#recordList > .main"),"加载中…","loading"),get_record($("#recordList > .main"),20),$(this).unbind("scroll"))})}function build_record_list(e,t){for(var a=t.entity.records,n=0;n<a.length;n++){var i=a[n].user.userName,s=a[n].typeName,o=a[n].objectName,r=a[n].belongId,c=a[n].objectId,l=a[n].startTime.substr(-5),d=a[n].startTime.substr(0,11),p=a[n].recordType.type;if(0!=n&&a[n].startTime.substr(0,11)!=a[n-1].startTime.substr(0,11))if(0==n&&e.find(".day").last().text==a[n].startTime.substr(0,11));else{var u=$('<div class="day"><em></em><p class="startDate">'+d+'</p><div class="ban"></div></div>');e.append(u)}else if(0==n&&0==recordPageNo){var u=$('<div class="day"><em></em><p class="startDate">'+d+'</p><div class="ban"></div></div>');e.append(u)}var h=$('<li class="boxSizing"><div class="info"><span class="userName">'+i+'</span><span class="typeName">'+s+':</span><span class="objectName">'+o+'</span><span class="startTime">'+l+"</span></div></li>");if(h.find(".objectName").attr({belongId:r,objectId:c}),h.find(".objectName").bind("click",function(){var e;1==$(this).attr("belongId")?e=apppath+"/wx/account/info.action?"+ddcommparams+"&accountId="+$(this).attr("objectId")+"&from=index&page=behavior":2==$(this).attr("belongId")?e=apppath+"/wx/contact/info.action?"+ddcommparams+"&contactId="+$(this).attr("objectId")+"&from=index&page=behavior":3==$(this).attr("belongId")&&(e=apppath+"/wx/opportunity/detail.action?"+ddcommparams+"&opportunityId="+$(this).attr("objectId")+"&from=index&page=behavior"),location.href=e}),"TEL"==p?h.addClass("phone_bg"):"SIGN_IN"==p?h.addClass("sign_in_bg"):"RECORD"==p&&h.addClass("record_bg"),a[n].content){var f=a[n].content,m=$('<span class="content_span">'+f+"</span>"),g=$('<div class="content"><em class="triangle"></em></div>');if(g.append(m),f.length>32){var v=f.substr(0,30)+"...",y=$('<span class="short_content_span">'+v+"</span>");g.append(y),m.css("display","none");var x=0,w=$('<em class="more"></em>');w.bind("click",function(){x++,$(this).parent().find(".short_content_span").slideToggle(),$(this).parent().find(".content_span").slideToggle(),$(this).css("transform","rotate("+(90+180*x)+"deg)")}),g.append(w)}h.append(g)}if(a[n].location){var b=$('<div class="location">'+a[n].location+"</div>");h.append(b)}var S=$('<div class="bottom_border"></div>');h.append(S),e.append(h)}removeBorder()}function removeBorder(){$("#record_tab li").each(function(){$(this).next().hasClass("day")&&$(this).find(".bottom_border").remove()})}function build_list_unit(e,t,a){var n=e.entity.records[a],i=n.saleStageText,s=n.opportunityName,o=n.money,r=n.accountName,c=n.id,l=n.saleStageOrder,d=n.saleStagePercentage,p=$('<li class="boxSizing"><em class="icon"></em><div class="info"><div class="top"><span class="opportunityName">'+s+'</span><span class="Money boxSizing">'+o+'元</span></div><div class="bot"><p class="accountName">'+r+'</p><p class="jieduan">阶段：'+i+'</p><span class="jieduan_p">'+d+"%</span></div></div></li>");p.attr("id",c),p.attr("name",s),p.find(".icon").addClass("jieduan"+l),p.bind("click",function(){location.href=apppath+"/wx/opportunity/detail.action?"+ddcommparams+"&opportunityId="+$(this).attr("id")+"&from=index"}),t.append(p)}function listScrollFunc(){$("#content").bind("scroll",function(){$("#load_more").length>0&&$("#load_more").offset().top<=$(window).height()-$("#load_more").height()-53&&($("#load_more.end_info").remove(),$("#list .main").append($('<div id="loading" class="end_info">加载中…</div>')),build_opp_list(apppath+"/wx/statics/topopportunity.action",$("#list .main"),build_list_unit,listScrollFunc,"scroll"))})}function opp_options(){$(".load-shadow").show(),$("#list .selector .options li").each(function(){$(this).bind("click",function(){oppDateType=$(this).attr("value"),pageNo=0,build_opp_list(apppath+"/wx/statics/topopportunity.action",$("#list .main"),build_list_unit,listScrollFunc)})})}function build_opp_list(e,t,a,n,i){obj={pageNo:pageNo,pagesize:pageSize,searchDateType:oppDateType},$.ajax({url:e,data:obj,async:!1,dataType:"json",success:function(e){if($("#performancePage .load-shadow").hide(),1==e.success){if(4==oppDateType){var s;localStorage.getItem(xsyUser.id)?(s=JSON.parse(localStorage.getItem(xsyUser.id)),s.index={oppData:e}):s={index:{oppData:e}},localStorage.setItem(xsyUser.id,JSON.stringify(s))}oppListByData(e,t,a,n,i)}else e.entity&&e.entity.status&&"0000003"==e.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:myAlert("网络不给力，请重新加载")},error:function(){myAlert("网络不给力，请重新加载")}})}function oppListByData(e,t,a,n,i){"scroll"!=i&&t.children().remove();var s,o=e.entity.records.length;if(0==o)t.append($('<div class="noInfo">该范围内没有重点商机</div>'));else{s=o-pageNo*pageSize>pageSize?pageSize:o-pageNo*pageSize;for(var r=0;s>r;r++)a(e,t,r);t.children().length<o&&t.append($('<div id="load_more" class="end_info">加载更多</div>')),obj.pageNo++,pageNo++,$("#loading").remove(),n()}}function workreportSelect(){$("#workreport_select .options li").on("click",function(){var e=$(this).attr("value"),t=$(this).text();$(".workreport-select-date").html(t),$(".workreport-select-date").attr("value",e),workreportSum(e)})}function workreportSum(e){if(localStorage.getItem(xsyUser.id)){var t=JSON.parse(localStorage.getItem(xsyUser.id));t.index&&t.index.workreportDate&&""!=t.index.workreportDate.searchDateType}$.ajax({url:apppath+"/wx/statics/staticinfo.action",data:{searchDateType:e},dataType:"json",success:function(e){if(1==e.success){$("#maccount_num").html(e.entity.newAddAccouontNum),$("#account_num").html(e.entity.allAccouontNum),$("#mcontact_num").html(e.entity.newAddContactNum),$("#contact_num").html(e.entity.AllContactNum),$("#mopp_num").html(e.entity.newAddOpportunityNum),$("#opp_num").html(e.entity.AllOpportunityNum),workreportUrl();var t;localStorage.getItem(xsyUser.id)?(t=JSON.parse(localStorage.getItem(xsyUser.id)),t.index={workreportDate:e}):t={index:{workreportDate:e}},localStorage.setItem(xsyUser.id,JSON.stringify(t))}else myAlert("网络不给力，请重新加载")},error:function(){myAlert("网络不给力，请重新加载")}})}function addschdule(){$(".index-add-schdule").on("click",function(){location.href=apppath+"/wx/schedule/add.action?"+ddcommparams+"&from=index_list&type=add"})}function workreportUrl(){var e=$(".workreport-select-date").attr("value");$("#acount_account").on("click",function(){location.href=apppath+"/wx/account/list.action?"+ddcommparams}),$("#acount_contact").on("click",function(){location.href=apppath+"/wx/account/list.action?"+ddcommparams}),$("#acount_opp").on("click",function(){location.href=apppath+"/wx/opportunity/list.action?"+ddcommparams}),$("#count_account").on("click",function(){location.href=apppath+"/wx/statics/account.action?"+ddcommparams+"&searchDateType="+e}),$("#count_contact").on("click",function(){location.href=apppath+"/wx/statics/contact.action?"+ddcommparams+"&searchDateType="+e}),$("#count_opp").on("click",function(){location.href=apppath+"/wx/statics/opportunity.action?"+ddcommparams+"&searchDateType="+e})}function getScduleinfo(){var e=curTime(),t=curTime();if(localStorage.getItem(xsyUser.id)){var a=JSON.parse(localStorage.getItem(xsyUser.id));a.index&&a.index.scheduleDate&&""!=a.index.scheduleDate.id&&createScduleList(a.index.scheduleDate)}if("reject"==GetQueryString("reject")){var n=GetQueryString("id");$(".schedule-item #"+n).remove()}$.ajax({type:"get",url:apppath+"/wx/schedule/dolist.action?d="+ +new Date,data:{startTime:e,endTime:t},async:!0,dataType:"json",success:function(e){if(0==e.success)myAlert("网络不给力，请重新加载");else{$(".load-shadow").hide();var t=e.entity.records;$.each(t,function(e,t){if(0==t.count){$(".schedule-body").children().remove();var a=$('<div class="schedule-body-null"><div class="schedule-null-content"><span class="null-ico"></span><p>今天没有日程哦</p><a href="javascript:;" class="index-add-schdule">马上添加</a></div></div>');$(".schedule-body").append(a),addschdule()}else{var n;localStorage.getItem(xsyUser.id)?(n=JSON.parse(localStorage.getItem(xsyUser.id)),n.index={scheduleDate:t.list}):n={index:{scheduleDate:t.list}},localStorage.setItem(xsyUser.id,JSON.stringify(n)),createScduleList(t.list)}}),tabChange(),indexWidth=$(".swiper-slide").width()}}})}function createScduleList(e){$(".schedule-body").children().remove();for(var t=$('<div class="schedule-item"></div>'),a=0,n=e.length;n>a;a++){var i=e[a].status,s=e[a].startDate.substring(11,16),o=e[a].endDate.substring(11,16),r=$('<div class="schedule-cell" id='+e[a].id+"></div>"),c=$('<div class="schedule-item-time"><span class="schedule-time-start">'+s+'</span><span class="schedule-time-line">-</span><span class="schedule-time-end">'+o+"</span></div>"),l=$('<div class="schedule-item-title">'+e[a].name+"</div>"),d=$('<div class="schedule-item-operate"><a href="javascript:;" class="schedule-item-accept">接受</a><a href="javascript:;" class="schedule-item-refuse">拒绝</a></div>');r.append(c),r.append(l),"1"==i&&r.append(d),"2"==i&&r.append(d),t.append(r)}$(".schedule-body").append(t),$(".schedule-item .schedule-cell").on("click",function(){var e=$(this).attr("id");location.href=apppath+"/wx/schedule/info.action?"+ddcommparams+"&from=index_schdule_list&id="+e}),schduleAccept(),scheduleReject()}function schduleAccept(){$(".schedule-item-accept").on("click",function(e){var t=$(this).closest(".schedule-cell").attr("id");e.stopPropagation(),acceptReceipt(t,$(this))})}function acceptReceipt(e,t){$.ajax({url:apppath+"/wx/schedule/doaccept.action",data:{id:e},dataType:"json",success:function(e){1==e.success&&(t.hide(),t.siblings().hide())}})}function scheduleReject(){$(".schedule-item-refuse").on("click",function(e){var t=$(this).closest(".schedule-cell").attr("id");e.stopPropagation(),rejectReceipt(t,$(this))})}function rejectReceipt(e,t){$.ajax({url:apppath+"/wx/schedule/doreject.action",data:{id:e},dataType:"json",success:function(e){1==e.success&&(t.hide(),t.siblings().hide(),t.closest(".schedule-cell").remove())}})}$(document).bind("ready",function(){setLocalStorage(),sort(),selectors(),build_opp_list(apppath+"/wx/statics/topopportunity.action",$("#list .main"),build_list_unit,listScrollFunc),actSumSelect(),followSum(),get_funnel(),change_funnel(),get_rank(),get_rank_data(rankDateType),opp_options(),workreportSelect(),workreportSum(),addschdule(),getScduleinfo(),$(".swiper-container").swiper({simulateTouch:!1,onSlideChangeEnd:function(e){var t=$("#performancePage");t.hasClass("swiper-slide-active")&&($(".performance").addClass("active"),$(".performance").siblings().removeClass("active"),tabChange());var a=$("#behaviorPage");a.hasClass("swiper-slide-active")&&($(".behavior").addClass("active"),$(".behavior").siblings().removeClass("active"),tabChange())}})});var indexWidth,pageNo=0,pageSize=10,oppDateType=4,obj={pageNo:pageNo,pagesize:pageSize,searchDateType:oppDateType},actLoad=!1,funnelDateType=4,actDateType=1,rankDateType=4,flag=!1,recordDateType=1,recordPageNo=0;