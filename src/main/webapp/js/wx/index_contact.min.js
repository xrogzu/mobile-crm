function contactSearchDateTypelist(t){var e=GetQueryString("searchDateType");$.ajax({type:"get",url:apppath+"/wx/contact/dolist.action?d="+ +new Date,data:{pageNo:pageNo,pagesize:pageSize,searchDateType:e},async:!0,dataType:"json",success:function(t){if($(".load-shadow").hide(),0==t.success)t.entity&&t.entity.status&&"0000003"==t.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:myAlert("网络不给力，请重新加载");else{for(var e=0,a=t.entity.records.length;a>e;e++)arr.push(t.entity.records[e]);if(0==t.entity.records.length){var o=$('<div class="content-reminder"><div class="ico"><p>暂无数据</p></div></div>');$("#list").append(o)}else build_list(arr);$("#list").find(".con").length<t.entity.totalSize?($("#loading").remove(),build_end("加载更多","load_more"),pageNo+=1):$("#loading").remove()}},error:function(){myAlert("网络不给力，请重新加载")}})}function build_list(t){for(var e,a=pageNo*pageSize;a<t.length;a++){e=/(?!^(\d+|[~!@#$%^&*?]+)$)^[\w~!@#$%\^&*?]+$/.test(t[a].contactName_py.substr(0,1))?t[a].contactName_py.substr(0,1):"#";var o,i=icon_word(t,a),n=$("#list").find('div[id="'+e.toUpperCase()+'"]');if(n.size())o=n.parent();else{if(0==a){var s=$("<li></li>"),c=$('<div class="top boxSizing" id="'+e.toUpperCase()+'">'+e.toUpperCase()+"</div>");s.append(c)}else if(e!=t[a-1].contactName_py.substr(0,1)&&!/^\d$/.test(t[a].contactName_py.substr(0,1))){var s=$("<li></li>"),c=$('<div class="top boxSizing" id="'+e.toUpperCase()+'">'+e.toUpperCase()+"</div>");s.append(c)}$("#list").append(s),o=$("#list > li:last")}var r=t[a].id,l=document.createElement("div");$(l).attr("value",r),l.className="con boxSizing";var d=t[a].contactName,p=t[a].post,u=t[a].accountName,v=t[a].mobile,m=t[a].phone;console.log(d),$(l).append($('<div class="pic boxSizing"><i class="cir">'+i+'</i></div><div class="info boxSizing" mobile = "'+v+'" phone = "'+m+'"><div class="info_detail"><span class="name">'+d+'</span> <span class="job">'+p+'</span><span class="company boxSizing">'+u+'</span></div><a class="tel_click"><em class="ico"></em></a></div>')),$("#list > li:last").append(l);$('<div class="tel_bg"></div>');o.append(l),set_cir_color($(l).find(".cir"))}con_click(),contacttelClick()}function contacttelClick(){var t=$("#list li .con");t.length;t.find(".tel_click").off("tap").on("tap",function(t){t.preventDefault();var e=$(this).closest(".con").attr("value"),a=$(this).closest(".info").attr("mobile"),o=$(this).closest(".info").attr("phone");if(""==a&&""==o){var i=$('<div class="no_contact">暂无联系方式，请填写联系方式</div>');$("body").append(i),setTimeout(function(){$(".no_contact").remove()},1e3)}else{$(window).scrollTop(0);var n=$('<div class="tel_bg"></div>'),s=$("body");s.append(n),n.css("top",$(document).scrollTop()),n.fadeIn(200);var c=$('<div id="tel_list" style="bottom:-288px;z-index:1000"></div>'),r=$('<div id="tel_list_warp"></div>');c.append(r),add_atom(r,a,"家庭电话",e),add_atom(r,o,"手机",e);var l=$('<div id="rtn_btn">取消</div>');l.on("click",function(){s.css({overflow:"",height:""}),n.remove(),c.animate({bottom:-c.height(),"z-index":"999"},300,function(){c.remove()})}),c.append(l),s.css({overflow:"hidden",height:"100%"}),s.append(c),setTimeout(function(){c.animate({bottom:0},300)},250),telAtomClick(e)}})}function add_atom(t,e,a,o){if(e&&""!=e){var i=$("<a href=tel:"+e+' class="tel_atom" ><span class="label">'+a+'</span><span class="value" >'+e+"</span></a>");t.append(i)}}function telAtomClick(t){$(".tel_atom").on("click",function(e){location.href=apppath+"/wx/activityrecord/create.action?"+ddcommparams+"&belongId=2&objectId="+t+"&activityTypeId="+activeRecordTypeOje.TEL+"&from=con_list&contactId="+t})}function icon_word(t,e){return/^[\u4e00-\u9fa5]+$/.test(t[e].contactName.substr(0,1))?t[e].contactName.substr(-2):t[e].contactName.substr(0,2)}function con_click(){$("#list .info_detail").each(function(t){$(this).click(function(){var t=$(this).parent().parent().attr("value"),e=$(this).find("span.name").text();location.href=apppath+"/wx/contact/info.action?"+ddcommparams+"&contactId="+t,local_set(t,e,2)})})}function local_set(t,e,a){if(1==a||2==a){var o={id:t,name:e,kindle:a};if(localStorage.getItem(userId)){var i=JSON.parse(localStorage.getItem(userId));if(i.accountHistory){for(var n=0;n<i.accountHistory.length;n++)i.accountHistory[n].id==t&&i.accountHistory.remove(n);i.accountHistory.push(o)}else var i={accountHistory:[o]}}else var i={accountHistory:[o]}}else if(3==a){var o={id:t,name:e};if("undefined"!=localStorage.getItem(userId)){var i=JSON.parse(localStorage.getItem(userId));if(i.opportunityHistory){for(var n=0;n<i.opportunityHistory.length;n++)i.opportunityHistory[n].id==t&&i.opportunityHistory.remove(n);i.opportunityHistory.push(o)}else var i={opportunityHistory:[o]}}else var i={opportunityHistory:[o]}}localStorage.setItem(userId,JSON.stringify(i))}function build_end(t,e){var a=$('<div id="'+e+'" class="end_info">'+t+"</div>");$("#list").append(a)}function iScrollClick(){if(/iPhone|iPad|iPod|Macintosh/i.test(navigator.userAgent))return!1;if(/Chrome/i.test(navigator.userAgent))return/Android/i.test(navigator.userAgent);if(/Silk/i.test(navigator.userAgent))return!1;if(/Android/i.test(navigator.userAgent)){var t=navigator.userAgent.substr(navigator.userAgent.indexOf("Android")+8,3);return!(parseFloat(t[0]+t[3])<44)}}function loaded(){myScroll=new IScroll("#content",{click:iScrollClick(),probeType:1,mouseWheel:!0,preventDefault:!1,scrollbars:!0,momentum:!0,useTransform:!1,click:!0,tap:!0,bounceTime:400,mouseWheelSpeed:400}),myScroll.on("scrollStart",function(){$("#load_more").length>0&&($("#load_more").remove(),build_end("加载中…","loading"),contactSearchDateTypelist())}),myScroll.on("scrollEnd",function(){$("#loading").remove()})}$(function(){contactSearchDateTypelist(),loaded()});var pageNo=0,pageSize=20,arr=[],userId=xsyUser.id,myScroll;