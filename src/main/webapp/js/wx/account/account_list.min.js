function add_account(){location.href=apppath+"/wx/account/add.action?"+ddcommparams+"&from=acc_list&type=add"}function acc_list_back(){"block"==$("#filter_area").css("display")?($("#filter_area").hide(),$(".filter").removeClass("active"),$(".filter").addClass("normal")):location.href=apppath+"/wx/statics/index.action?"+ddcommparams}function filter(){stopScroll($("#filter_area"));var t=0;$("#filter").on("click",function(a){a.stopPropagation(),$("#filter_area .content").find(".filter_btn").length<=1&&create_filter(),0==t?($("#filter").addClass("active"),$("#filter").removeClass("normal"),t=1):($("#filter").addClass("normal"),$("#filter").removeClass("active"),t=0),$("#filter_area").toggle(),$("#filter_area").off("touch click").on("touch click",function(t){t.stopPropagation(),$(t.target).closest(".shadow").size()||$(t.target).closest(".filter").size()||$("#filter_area").hide()})})}function create_filter(){$.ajax({type:"get",url:apppath+"/wx/account/getLevelInfo.action",async:!0,dataType:"json",success:function(t){if(0==t.success)myAlert("网络不给力，请重新加载");else{for(var a=[],e=0,o=t.entity.length;o>e;e++){var i=$('<div class="filter_btn boxSizing">'+t.entity[e].label+"</div>");a.push(t.entity[e].value),$("#filter_area .content").append(i)}$("#filter_area .filter_btn").each(function(t){$(this).on("click",function(){if(pageNo=0,$(this).addClass("active"),$(this).siblings().removeClass("active"),$("#filter_area").hide(),$("#list").children().remove(),$(this).index()>0){var t=a[$(this).index()-1];arr=[],create_account_list(t)}else arr=[],create_account_list(0)})})}},error:function(){myAlert("网络不给力，请重新加载")}})}function earlyLoad(){if(xsyUser&&localStorage.getItem(xsyUser.id)){var t=JSON.parse(localStorage.getItem(xsyUser.id));t.accountList&&t.accountList.accListData&&(accListByData(t.accountList.accListData),pageNo=0)}}function create_account_list(t){$.ajax({type:"get",url:apppath+"/wx/account/dolist.action?d="+ +new Date,data:{pageNo:pageNo,pagesize:pageSize,level:t},async:!0,dataType:"json",success:function(a){if(console.log(a),$(".load-shadow").hide(),0==a.success)a.entity&&a.entity.status&&"0000003"==a.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:myAlert("网络不给力，请重新加载");else{if(0==t&&xsyUser){var e;localStorage.getItem(xsyUser.id)?(e=JSON.parse(localStorage.getItem(xsyUser.id)),e.accountList={accListData:a}):e={accountList:{accListData:a}},localStorage.setItem(xsyUser.id,JSON.stringify(e))}0==t&&$("#list").children().remove(),accListByData(a)}},error:function(){myAlert("网络不给力，请重新加载")}})}function accListByData(t){arr=[];for(var a=0,e=t.entity.records.length;e>a;a++)arr.push(t.entity.records[a]);if(0==t.entity.records.length){var o=$('<div class="content-reminder"><div class="ico"><p>暂无数据</p></div></div>');$("#list").append(o)}else build_list(arr);console.log($("#list").find(".con").length),$("#list").find(".con").length<t.entity.totalSize?($("#loading").remove(),build_end("加载更多","load_more"),pageNo+=1,loaded()):$("#loading").remove()}function scroll_load(){$("#content").on("scroll",function(){loaded()})}function build_list(t){for(var a,e=0,o=t.length;o>e;e++){a=/(?!^(\d+|[~!@#$%^&*?]+)$)^[\w~!@#$%\^&*?]+$/.test(t[e].accountName_py.substr(0,1))?t[e].accountName_py.substr(0,1):"#";var i,c=$("#list").find('div[id="'+a.toUpperCase()+'"]');if(c.size())i=c.parent();else{if(0==e){var n=$("<li></li>"),r=$('<div class="top boxSizing" id="'+a.toUpperCase()+'">'+a.toUpperCase()+"</div>");n.append(r)}else if(a!=t[e-1].accountName_py.substr(0,1)&&!/^\d$/.test(t[e].accountName_py.substr(0,1))){var n=$("<li></li>"),r=$('<div class="top boxSizing" id="'+a.toUpperCase()+'">'+a.toUpperCase()+"</div>");n.append(r)}$("#list").append(n),i=$("#list > li:last")}listAccountId=t[e].id,listAccountName=t[e].accountName;var s=document.createElement("div");$(s).attr("value",listAccountId),s.className="con boxSizing",$(s).append($('<div class="info" > <span class="accountName">'+listAccountName+'</span><em class="sign_in"></em></div>')),$(s).find("em").on("click",function(t){location.href=apppath+"/wx/activityrecord/qiandao.action?"+ddcommparams+"&belongId=1&objectId="+$(this).parent().parent().attr("value")+"&activityTypeId="+activeRecordTypeOje.SIGN_IN+"&from=acc_info&accountId="+$(this).parent().parent().attr("value"),t.stopPropagation()}),i.append(s)}con_click()}function con_click(){$("#list li div.con").each(function(t){$(this).click(function(){var t=$(this).attr("value"),a=$(this).find("span.accountName").text();local_set(t,a,1),location.href=apppath+"/wx/account/info.action?"+ddcommparams+"&accountId="+t})})}function local_set(t,a,e){if(1==e||2==e){var o={id:t,name:a,kindle:e};if(localStorage.getItem(userId)){var i=JSON.parse(localStorage.getItem(userId));if(i.accountHistory){for(var c=0;c<i.accountHistory.length;c++)i.accountHistory[c].id==t&&i.accountHistory.remove(c);i.accountHistory.push(o)}else var i={accountHistory:[o]}}else var i={accountHistory:[o]}}else if(3==e){var o={id:t,name:a};if("undefined"!=localStorage.getItem(userId)){var i=JSON.parse(localStorage.getItem(userId));if(i.opportunityHistory){for(var c=0;c<i.opportunityHistory.length;c++)i.opportunityHistory[c].id==t&&i.opportunityHistory.remove(c);i.opportunityHistory.push(o)}else var i={opportunityHistory:[o]}}else var i={opportunityHistory:[o]}}localStorage.setItem(userId,JSON.stringify(i))}function build_end(t,a){var e=$('<div id="'+a+'" class="end_info">'+t+"</div>");$("#list").append(e)}function loaded(){myScroll=new IScroll("#content",{mouseWheel:!0,preventDefault:!1,scrollbars:!0,momentum:!0,useTransform:!1,click:!0,tap:!0,bounceTime:200,mouseWheelSpeed:200}),myScroll.on("scrollStart",function(){$("#load_more").length>0&&($("#load_more").remove(),build_end("加载中…","loading"),create_account_list())}),myScroll.on("scrollEnd",function(){$("#loading").remove()})}$(document).on("ready",function(){earlyLoad(),$("#txt").on("click",function(){location.href=apppath+"/wx/account/search.action?"+ddcommparams}),create_account_list(0),filter(),$("#linkman").on("click",function(){location.href=apppath+"/wx/contact/list.action?"+ddcommparams}),$("#ipt_area").on("click",function(){location.href=apppath+"/wx/account/search.action?"+ddcommparams}),$("#addAccount").on("click",function(){add_account()})});var pageNo=0,pageSize=20,arr=[],listAccountId,listAccountName,userId=xsyUser.id,myScroll;