function add_contact(){location.href=apppath+"/wx/contact/add.action?"+ddcommparams+"&from=con_list&type=add"}function con_list_back(){"block"==$("#filter_area").css("display")?($("#filter_area").hide(),$(".filter").removeClass("active"),$(".filter").addClass("normal")):location.href=apppath+"/wx/statics/index.action?"+ddcommparams}function filter(){stopScroll($("#filter_area"));var t=0;$("#filter").on("click",function(){$("#filter_area .content").find(".filter_btn").length<=1&&create_filter(),0==t?($("#filter").addClass("active"),$("#filter").removeClass("normal"),t=1):($("#filter").addClass("normal"),$("#filter").removeClass("active"),t=0),$("#filter_area").toggle(),$("#filter_area").off("touch click").on("touch click",function(t){t.stopPropagation(),$(t.target).closest(".shadow").size()||$(t.target).closest(".filter").size()||$("#filter_area").hide()})})}function create_filter(){$.ajax({type:"get",url:apppath+"/wx/contact/getCreateDateTypeInfo.action",async:!0,dataType:"json",success:function(t){if(0==t.success)myAlert("网络不给力，请重新加载");else{for(var e=[],a=0,i=t.entity.length;i>a;a++){var o=$('<div class="filter_btn boxSizing">'+t.entity[a].label+"</div>");e.push(t.entity[a].value),$("#filter_area .content").append(o)}$("#filter_area .filter_btn").eq(0).addClass("active"),$("#filter_area .filter_btn").each(function(t){$(this).on("click",function(){pageNo=0,$(this).addClass("active"),$(this).siblings().removeClass("active"),$("#filter_area").hide(),$("#list").children().remove();var t=e[$(this).index()];$(this).index()>0?(arr=[],create_contact_list(t)):(arr=[],create_contact_list())})})}},error:function(){myAlert("网络不给力，请重新加载")}})}function create_contact_list(t){$.ajax({type:"get",url:apppath+"/wx/contact/dolist.action?d="+ +new Date,data:{pageNo:pageNo,pagesize:pageSize,createDateType:t},async:!0,dataType:"json",success:function(t){if($(".load-shadow").hide(),0==t.success)t.entity&&t.entity.status&&"0000003"==t.entity.status?location.href=apppath+"/wx/authorized/no.action?"+ddcommparams:myAlert("网络不给力，请重新加载");else{for(var e=0,a=t.entity.records.length;a>e;e++)arr.push(t.entity.records[e]);if(0==t.entity.records.length){var i=$('<div class="content-reminder"><div class="ico"><p>暂无数据</p></div></div>');$("#list").append(i)}else build_list(arr);$("#list").find(".con").length<t.entity.totalSize?($("#loading").remove(),build_end("加载更多","load_more"),pageNo+=1):$("#loading").remove()}},error:function(){myAlert("网络不给力，请重新加载")}})}function build_list(t){for(var e,a=pageNo*pageSize;a<t.length;a++){e=/(?!^(\d+|[~!@#$%^&*?]+)$)^[\w~!@#$%\^&*?]+$/.test(t[a].contactName_py.substr(0,1))?t[a].contactName_py.substr(0,1):"#";var i,o=icon_word(t,a),n=$("#list").find('div[id="'+e.toUpperCase()+'"]');if(n.size())i=n.parent();else{if(0==a){var c=$("<li></li>"),r=$('<div class="top boxSizing" id="'+e.toUpperCase()+'">'+e.toUpperCase()+"</div>");c.append(r)}else if(e!=t[a-1].contactName_py.substr(0,1)&&!/^\d$/.test(t[a].contactName_py.substr(0,1))){var c=$("<li></li>"),r=$('<div class="top boxSizing" id="'+e.toUpperCase()+'">'+e.toUpperCase()+"</div>");c.append(r)}$("#list").append(c),i=$("#list > li:last")}var s=t[a].id,l=document.createElement("div");$(l).attr("value",s),l.className="con boxSizing";var d=t[a].contactName,p=t[a].post,f=t[a].accountName,u=t[a].mobile,m=t[a].phone;console.log(d),$(l).append($('<div class="pic boxSizing"><i class="cir">'+o+'</i></div><div class="info boxSizing" mobile = "'+u+'" phone = "'+m+'"><div class="info_detail"><span class="name">'+d+'</span> <span class="job">'+p+'</span><span class="company boxSizing">'+f+'</span></div><a class="tel_click"><em class="ico"></em></a></div>')),$("#list > li:last").append(l);$('<div class="tel_bg"></div>');i.append(l),set_cir_color($(l).find(".cir"))}con_click(),contacttelClick()}function contacttelClick(){var t=$("#list li .con");t.length;t.find(".tel_click").off("tap").on("tap",function(t){t.preventDefault();var e=$(this).closest(".con").attr("value"),a=$(this).closest(".info").attr("mobile"),i=$(this).closest(".info").attr("phone");if(""==a&&""==i){var o=$('<div class="no_contact">暂无联系方式，请填写联系方式</div>');$("body").append(o),setTimeout(function(){$(".no_contact").remove()},1e3)}else{$(window).scrollTop(0);var n=$('<div class="tel_bg"></div>'),c=$("body");c.append(n),n.css("top",$(document).scrollTop()),n.fadeIn(200);var r=$('<div id="tel_list" style="bottom:-288px;z-index:1000"></div>'),s=$('<div id="tel_list_warp"></div>');r.append(s),add_atom(s,a,"家庭电话",e),add_atom(s,i,"手机",e);var l=$('<div id="rtn_btn">取消</div>');l.on("click",function(){c.css({overflow:"",height:""}),n.remove(),r.animate({bottom:-r.height(),"z-index":"999"},300,function(){r.remove()})}),r.append(l),c.css({overflow:"hidden",height:"100%"}),c.append(r),setTimeout(function(){r.animate({bottom:0},300)},250),telAtomClick(e)}})}function add_atom(t,e,a,i){if(e&&""!=e){var o=$("<a href=tel:"+e+' class="tel_atom" ><span class="label">'+a+'</span><span class="value" >'+e+"</span></a>");t.append(o)}}function telAtomClick(t){$(".tel_atom").on("click",function(e){location.href=apppath+"/wx/activityrecord/create.action?"+ddcommparams+"&belongId=2&objectId="+t+"&activityTypeId="+activeRecordTypeOje.TEL+"&from=con_list&contactId="+t})}function icon_word(t,e){return/^[\u4e00-\u9fa5]+$/.test(t[e].contactName.substr(0,1))?t[e].contactName.substr(-2):t[e].contactName.substr(0,2)}function con_click(){$("#list .info_detail").each(function(t){$(this).click(function(){var t=$(this).parent().parent().attr("value"),e=$(this).find("span.name").text();location.href=apppath+"/wx/contact/info.action?"+ddcommparams+"&contactId="+t,local_set(t,e,2)})})}function local_set(t,e,a){if(1==a||2==a){var i={id:t,name:e,kindle:a};if(localStorage.getItem(userId)){var o=JSON.parse(localStorage.getItem(userId));if(o.accountHistory){for(var n=0;n<o.accountHistory.length;n++)o.accountHistory[n].id==t&&o.accountHistory.remove(n);o.accountHistory.push(i)}else var o={accountHistory:[i]}}else var o={accountHistory:[i]}}else if(3==a){var i={id:t,name:e};if("undefined"!=localStorage.getItem(userId)){var o=JSON.parse(localStorage.getItem(userId));if(o.opportunityHistory){for(var n=0;n<o.opportunityHistory.length;n++)o.opportunityHistory[n].id==t&&o.opportunityHistory.remove(n);o.opportunityHistory.push(i)}else var o={opportunityHistory:[i]}}else var o={opportunityHistory:[i]}}localStorage.setItem(userId,JSON.stringify(o))}function build_end(t,e){var a=$('<div id="'+e+'" class="end_info">'+t+"</div>");$("#list").append(a)}function iScrollClick(){if(/iPhone|iPad|iPod|Macintosh/i.test(navigator.userAgent))return!1;if(/Chrome/i.test(navigator.userAgent))return/Android/i.test(navigator.userAgent);if(/Silk/i.test(navigator.userAgent))return!1;if(/Android/i.test(navigator.userAgent)){var t=navigator.userAgent.substr(navigator.userAgent.indexOf("Android")+8,3);return!(parseFloat(t[0]+t[3])<44)}}function loaded(){myScroll=new IScroll("#content",{click:iScrollClick(),mouseWheel:!0,preventDefault:!1,scrollbars:!0,momentum:!0,useTransform:!1,click:!0,tap:!0,bounceTime:400,mouseWheelSpeed:400}),myScroll.on("scrollStart",function(){$("#load_more").length>0&&($("#load_more").remove(),build_end("加载中…","loading"),create_contact_list())}),myScroll.on("scrollEnd",function(){$("#loading").remove()})}$(document).on("ready",function(){$("#txt").on("click",function(){location.href=apppath+"/wx/account/search.action?"+ddcommparams}),create_contact_list(),filter(),$("#company").on("click",function(){location.href=apppath+"/wx/account/list.action?"+ddcommparams}),$("#ipt_area").on("click",function(){location.href=apppath+"/wx/account/search.action?"+ddcommparams}),$("#addContact").on("click",function(){add_contact()}),loaded()});var pageNo=0,pageSize=20,arr=[],userId=xsyUser.id,myScroll;