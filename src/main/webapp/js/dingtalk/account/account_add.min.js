function getStartValue(){accountNameValue=$("#accountName input").val(),levelValue=$("#level").attr("value"),industryIdValue=$("#industryId button").html(),telValue=$("#phone input").val(),addressValue=$("#address input").val(),faxValue=$("#fax input").val(),textareaValue=$("textarea").val(),statusValue=$("#status button").html(),ownerPostValue=$("#ownerPost  button").html()}function backRemind(){var t=!1;accountNameValue==$("#accountName input").val()&&levelValue==$("#level").attr("value")&&industryIdValue==$("#industryId button").html()&&telValue==$("#phone input").val()&&addressValue==$("#address input").val()&&faxValue==$("#fax input").val()&&textareaValue==$("textarea").val()&&statusValue==$("#status button").html()&&ownerPostValue==$("#ownerPost  button").html()||(t=!0);var a;"acc_list"==GetQueryString("from")?a=apppath+"/dingtalk/account/list.action?"+ddcommparams:"acc_info"==GetQueryString("from")&&(a=apppath+"/dingtalk/account/info.action?"+ddcommparams+"&accountId="+GetQueryString("accountId")),$(".ct").length>0?($("body").css("height",""),$(".ct").remove(),remove_rTop(),add_page_title(),$("body").css("overflow","")):t?0==$(".chooseShadow").length?myChoose(a):$(".chooseShadow").remove():location.href=a}function add_page_title(){null!=GetQueryString("type")&&"set"==GetQueryString("type")?set_title("编辑公司"):set_title("新建公司")}function level_choose(){$("#level").bind("click",function(){checkTable("选择公司等级"),$.ajax({type:"get",url:apppath+"/dingtalk/account/getLevelInfo.action",async:!0,success:function(data){var oData=eval("("+data+")");create_level_list(oData)}})})}function create_level_list(t){for(var a=$('<div class="container"></div>'),e=0;e<t.entity.length;e++){var n=$('<div class="item boxSizing"><em class="radio"><i></i></em><span>'+t.entity[e].label+"</span></div>");a.append(n)}$(".ct").append(a);for(var e=0;e<$(".ct .item").length;e++)$("#level button").html()==$(".ct .item").eq(e).find("span").text()&&$(".ct .item").eq(e).find("em").addClass("active");$(".ct .item").each(function(a){$(this).bind("click",function(){$(this).find("em").addClass("active"),$(this).siblings().find("em").removeClass("active");var a=t.entity[$(this).index()].value,e=($(this).index(),t.entity[$(this).index()].label);$("#level button").html(e),btn_color_adjust(),$("#level").attr("value",a),$(".ct").remove(),remove_rTop(),add_page_title(),$("body").css({overflow:"scroll",height:"auto"})})})}function status_choose(){$("#status").attr("value",1),$("#status").bind("click",function(){checkTable("选择公司状态"),$.ajax({type:"get",url:apppath+"/dingtalk/account/getstates.action",async:!0,success:function(data){var oData=eval("("+data+")");oData.success?(console.log("公司状态"+data),create_status_list(oData)):myAlert("暂时无法获取数据，请稍后再试")},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})})}function create_status_list(t){for(var a=$('<div class="container"></div>'),e=0;e<t.entity.length;e++){var n=$('<div class="item boxSizing"><em class="radio"><i></i></em><span>'+t.entity[e].label+"</span></div>");a.append(n)}$(".ct").append(a);for(var e=0;e<$(".ct .item").length;e++)$("#status button").html()==$(".ct .item").eq(e).find("span").text()&&$(".ct .item").eq(e).find("em").addClass("active");$(".ct .item").each(function(a){$(this).bind("click",function(){$(this).find("em").addClass("active"),$(this).siblings().find("em").removeClass("active");var a=t.entity[$(this).index()].value,e=t.entity[$(this).index()].label;$("#status button").html(e),btn_color_adjust(),$("#status").attr("value",a),$(".ct").remove(),remove_rTop(),add_page_title(),$("body").css({overflow:"scroll",height:"auto"})})})}function industry_choose(){$("#industryId").bind("click",function(){checkTable("选择行业"),$.ajax({type:"get",url:apppath+"/dingtalk/account/industryIds.action",async:!0,success:function(data){var oData=eval("("+data+")");create_industry_list(oData)}})})}function create_industry_list(t){for(var a=$('<div class="container"></div>'),e=0;e<t.entity.length;e++){var n=$('<div class="item boxSizing"><em class="radio"><i></i></em><span>'+t.entity[e].label+"</span></div>");a.append(n)}$(".ct").append(a);for(var e=0;e<$(".ct .item").length;e++)$("#industryId > button").html()==$(".ct .item").eq(e).find("span").text()&&$(".ct .item").eq(e).find("em").addClass("active");$(".ct .item").each(function(a){$(this).bind("click",function(){$(this).find("em").addClass("active"),$(this).siblings().find("em").removeClass("active");var a=t.entity[$(this).index()].value,e=($(this).index(),t.entity[$(this).index()].label);$("#industryId button").html(e),btn_color_adjust(),$("#industryId").attr("value",a),$(".ct").remove(),remove_rTop(),add_page_title(),$("body").css({overflow:"scroll",height:"auto"})})})}function get_post(){$.ajax({type:"get",url:apppath+"/dingtalk/department/mydepartment.action",async:!0,success:function(data){console.log("部门"+data);var oData=eval("("+data+")");0==oData.success?myAlert("暂时无法获取数据，请稍后再试"):(postData=oData,setPost&&($("#ownerPost").attr("value",postData.entity.departs[0].id),$("#ownerPost  button").html(postData.entity.departs[0].text),getStartValue()))},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function change_post(){$("#ownerPost button").bind("click",function(){checkTable("选择所属部门");var t=$('<div id="container" class="container"></div>');$(".ct").append(t),build_list(t,postData)})}function build_list(t,a){for(var e=0;e<a.entity.departs.length;e++){var n=$('<div class="item"><em class="radio"><i></i></em><span>'+a.entity.departs[e].text+"</span></div>");n.attr("value",a.entity.departs[e].id),t.append(n)}for(var e=0;e<$(".ct .item").length;e++)$("#ownerPost button").html()==$(".ct .item").eq(e).find("span").text()&&$(".ct .item").eq(e).find("em").addClass("active");radio_click(a)}function radio_click(t){$(".ct .item").each(function(t){$(this).bind("click",function(){$(this).find("em").hasClass("active")||($(this).find("em").addClass("active"),$(this).siblings().find("em").removeClass("active"));var t=$(this).attr("value"),a=$(this).find("span").text();$("#ownerPost > button").html(a),btn_color_adjust(),$("#ownerPost").attr("value",t),$(".ct").remove(),remove_rTop(),add_page_title(),$("body").css({overflow:"scroll",height:"auto"})})})}function confirm(){function t(t){rtn_reg($("#accountName input"),reg_accountName)&&rtn_reg($("#phone input"),reg_tel)&&rtn_reg($("#address input"),reg_address)&&rtn_reg($("#fax input"),reg_fax)?info_submit(t):(""==$("#accountName input").val()?(confirm_reg($("#accountName input"),reg_accountName,"公司名称不能为空"),$(window).scrollTop(0)):confirm_reg($("#accountName input"),reg_accountName,"公司名称格式错误"),confirm_reg($("#phone input"),reg_tel,"电话格式错误"),confirm_reg($("#address input"),reg_address,"地址格式错误"),confirm_reg($("#fax input"),reg_fax,"传真格式错误"))}$("#confirm").bind("click",function(){t()}),$("#add_contact").bind("click",function(){t("add_contact")})}function info_submit(action){var url="";if("set"==GetQueryString("type")){url=apppath+"/dingtalk/account/doupdate.action",console.log("更新接口");var accountTemp={accountName:$("#accountName input").val(),level:$("#level").attr("value"),industryId:$("#industryId").attr("value"),phone:$("#phone input").val(),address:$("#address input").val(),fax:$("#fax input").val(),ownerId:ownerId,dbcSelect1:$("#status").attr("value"),dimDepart:$("#ownerPost").attr("value"),comment:$("#remark textarea").val(),id:GetQueryString("accountId")}}else{url=apppath+"/dingtalk/account/docreate.action",console.log("创建接口");var accountTemp={accountName:$("#accountName input").val(),level:$("#level").attr("value"),industryId:$("#industryId").attr("value"),phone:$("#phone input").val(),address:$("#address input").val(),fax:$("#fax input").val(),ownerId:ownerId,dbcSelect1:$("#status").attr("value"),dimDepart:$("#ownerPost").attr("value"),comment:$("#remark textarea").val()}}$.ajax({type:"post",url:url,data:{account:JSON.stringify(accountTemp)},async:!0,beforeSend:function(){$(".confirm").attr("disabled","true"),loader()},success:function(data){$(".loaderArea").remove();var oData=eval("("+data+")");if(1==oData.success){if("set"==GetQueryString("type")){var buriedPointType="accountUpdate";buriedPoint(buriedPointType)}else{var buriedPointType="accountAdd";buriedPoint(buriedPointType)}myDialog("保存成功"),setTimeout(function(){if("add_contact"==action)location.href=apppath+"/dingtalk/contact/add.action?"+ddcommparams+"&from=acc_add&accountId="+oData.entity.id+"&accountName="+$("#accountName input").val();else{if("set"==GetQueryString("type"))var t=GetQueryString("accountId");else var t=oData.entity.id;location.href=apppath+"/dingtalk/account/info.action?"+ddcommparams+"&accountId="+t}},2e3)}else 0==oData.success&&($(".confirm").removeAttr("disabled"),oData.entity&&oData.entity.status&&"0000001"==oData.entity.status?myAlert("保存失败，公司名称已存在"):oData.entity&&oData.entity.status&&"0000002"==oData.entity.status?myAlert("保存失败，不能包含表情符"):oData.entity&&oData.entity.status&&"0000003"==oData.entity.status?location.href=apppath+"/dingtalk/authorized/no.action?"+ddcommparams:myAlert("保存失败，请检查输入信息"))},error:function(){$(".loaderArea").remove(),$(".confirm").removeAttr("disabled"),myAlert("暂时无法获取数据，请检查您的网络")}})}function set_info(){$.ajax({url:apppath+"/dingtalk/account/get.action",data:{accountId:GetQueryString("accountId")},success:function(data){var oData=eval("("+data+")");console.log(oData),ownerId=oData.entity.ownerId,$("#accountName input").val(oData.entity.accountName),$("#level button").html(oData.entity.levelText),btn_color_adjust(),$("#level").attr("value",oData.entity.level),$("#industryId button").html(oData.entity.industryIdText),btn_color_adjust(),$("#industryId").attr("value",oData.entity.industryId),$("#phone input").val(oData.entity.phone),$("#address input").val(oData.entity.address),$("#fax input").val(oData.entity.fax),$("#owner").attr("value",oData.entity.ownerId),$("#owner button").html(oData.entity.ownerText),$("#status button").html(oData.entity.dbcSelect1Text),$("#status").attr("value",oData.entity.dbcSelect1),$("#ownerPost").attr("value",oData.entity.dimDepart),$("#ownerPost  button").html(oData.entity.dimDepartText),btn_color_adjust(),$("#remark textarea").val(oData.entity.comment),getStartValue(),$("textarea").autoHeight(),textarea_num()}})}$(document).bind("ready",function(){get_post(),add_page_title(),remove_rTop(),$("#level").attr("value",3),"set"==GetQueryString("type")?(set_info(),$("#add_contact").remove(),$("#confirm").html("保存")):setPost=!0,$("textarea").autoHeight(),textarea_num(),level_choose(),status_choose(),industry_choose(),xsyUser||alert("获取当前用户失败"),btn_color_adjust(),btn_touch_style(),change_post(),confirm(),input_color_adjust(),$("input").each(function(){$(this).bind("click",function(){$(this).hasClass("warn")&&remove_warn($(this))})}),input_adjust()}),dd.ready(function(){control_back(backRemind)});var accountNameValue,levelValue,industryIdValue,telValue,addressValue,faxValue,textareaValue,statusValue,ownerPostValue,reg_accountName=/^.{1,50}$/,reg_tel=/^\d+|[-#*]{0,30}$/,reg_address=/^.{0,250}$/,reg_fax=/^.{0,30}$/,postData,setPost=!1,ownerId=xsyUser.id;