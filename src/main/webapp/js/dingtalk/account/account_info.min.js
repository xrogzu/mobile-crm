function toAccountList(){$(".cOwnerShadow").remove(),$(".ct").length>0?memberChange?myChoose("",ctRemove):ctRemove():"opp_info"==GetQueryString("from")?location.href=apppath+"/dingtalk/opportunity/detail.action?"+ddcommparams+"&opportunityId="+GetQueryString("ropportunityId"):"con_info"==GetQueryString("from")?location.href=apppath+"/dingtalk/contact/info.action?"+ddcommparams+"&contactId="+GetQueryString("rcontactId"):"acc_info"==GetQueryString("from")?location.href=apppath+"/dingtalk/account/info.action?"+ddcommparams+"&accountId="+GetQueryString("raccountId"):"index"==GetQueryString("from")?GetQueryString("page")?location.href=apppath+"/dingtalk/statics/index.action?"+ddcommparams+"&page="+GetQueryString("page"):location.href=apppath+"/dingtalk/statics/index.action?"+ddcommparams:location.href=apppath+"/dingtalk/account/list.action?"+ddcommparams}function ctRemove(){$("body").css("height",""),$("body").css("overflow",""),ceilingJudge(),$(".ct").remove(),set_title("公司信息"),set_right("更多",more)}function more(){if($("#area").length>0)$("#area").remove();else{var t;t=$('<ul id="area" class="boxSizing"><div class="triangle"></div> <li id="add_contact">添加联系人</li><li id="new_business">新建销售机会</li></ul>');var a=$('<li id="set_account">编辑公司</li>'),e=$('<li id="delete_account">删除公司</li>');dataPermission.update&&t.append(a),dataPermission["delete"]&&t.append(e),$("body").append(t),$("#area > #add_contact").bind("click",function(){$("#area").remove(),location.href=apppath+"/dingtalk/contact/add.action?"+ddcommparams+"&from=acc_info&accountId="+GetQueryString("accountId")+"&accountName="+accountName}),$("#area > #new_business").bind("click",function(){$("#area").remove(),console.log("跳转到新建销售机会页面"),location.href=apppath+"/dingtalk/opportunity/add.action?"+ddcommparams+"&from=acc_info&accountId="+GetQueryString("accountId")}),$("#area > #set_account").bind("click",function(){$("#area").remove(),location.href=apppath+"/dingtalk/account/add.action?"+ddcommparams+"&type=set&from=acc_info&accountId="+GetQueryString("accountId")}),$("#area > #delete_account").bind("click",function(){$("#area").remove(),delete_dialog()})}}function delete_dialog(){var t=$('<div class="shadow"><div class="dia"><p class="boxSizing">确定删除吗?</p><div class="confirm"><div class="no">取消</div><div class="yes boxSizing">确认</div></div></div></div>');$("body").append(t),$(".dia").css({top:"200px",left:($(window).width()-$(".dia").width())/2}),$(".yes").bind("click",function(){delete_account(),$(".shadow").remove()}),$(".no").bind("click",function(){$(".shadow").remove()})}function delete_account(){$.ajax({url:apppath+"/dingtalk/account/dodel.action",data:{accountId:GetQueryString("accountId")},async:!1,success:function(data){var oData=eval("("+data+")");oData.success?($(".shadow").remove(),myDialog("删除成功"),time_out_location(apppath+"/dingtalk/account/list.action?"+ddcommparams)):myAlert("删除失败")},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function top_nav(){$(window).bind("scroll",function(){ceilingJudge()})}function ceilingJudge(){$("body").scrollTop()>=nav_top?($("#topNav").css({position:"fixed",top:0}),$(".white_ban").css({position:"fixed",top:"80px"}),$(".common").css("paddingBottom","90px")):($("#topNav").css({position:"",top:"",bottom:""}),$(".common").css({paddingBottom:"",position:"relative"}),$(".white_ban").css({position:"absolute",bottom:"-10px",top:""}),$(".common").append($(".white_ban")))}function nav(){$("#topNav").bind("scroll",function(){$("#nav").offset().left>-20?$(".left_filter").fadeOut(200):$(".left_filter").fadeIn(200),$("#nav").offset().left<=$(window).width()-$("#nav").width()-30?$(".right_filter").fadeOut(200):$(".right_filter").fadeIn(200)}),$("#nav li").each(function(){$(this).bind("click",function(){$(this).addClass("active"),$(this).siblings().removeClass("active"),tab($(this).attr("href"))})})}function filter_touch(){$(".right_filter").bind("touchend",function(){$("#topNav").scrollLeft(300)}),$(".left_filter").bind("touchend",function(){$("#topNav").scrollLeft(0)})}function tab(t){if($("html, body").animate({scrollTop:0},300),$("#topNav").css({position:"",top:"",bottom:""}),$(".common").css({paddingBottom:"",position:"relative"}),$(".white_ban").css({position:"absolute",bottom:"-5px",top:""}),$(".common").append($(".white_ban")),$(".content").fadeOut(300),"联系人"==t){if(0==$("#contact_tab").length){$(".tab").length>0&&$(".tab").remove();var a=$('<ul id="contact_tab" class="tab contact boxSizing"><div class="main boxSizing"></div></ul>');$("body").append(a),contactPageNo=0,get_contacts($("#contact_tab > .main"),20,"tab"),$("#contact_tab").fadeIn(300)}}else if("记录"==t){if(0==$("#record_tab").length){$(".tab").length>0&&$(".tab").remove();var a=$('<ul id="record_tab" class="tab record boxSizing"><div class="main boxSizing"></div></ul>');$("body").append(a),recordPageNo=0,get_record($("#record_tab > .main"),20,"tab"),$("#record_tab").fadeIn(300)}}else if("商机"==t){if(0==$("#opportunity_tab").length){$(".tab").length>0&&$(".tab").remove();var a=$('<ul id="opportunity_tab" class="tab opportunity boxSizing"><div class="main boxSizing"></div></ul>');$("body").append(a),opportunityPageNo=0,get_opportunity($("#opportunity_tab > .main"),20,"tab"),$("#opportunity_tab").fadeIn(300)}}else if("详情"==t){if(0==$("#info_tab").length){$(".tab").length>0&&$(".tab").remove();var a=$('<ul id="info_tab" class="tab details boxSizing"><div class="main boxSizing"></div></ul>');$("body").append(a),get_info($("#info_tab > .main")),$("#info_tab").append($('<div class="staff boxSizing"> <div class="owner boxSizing"> <span class="label">负责人:</span> <span class="value"></span> </div> <div class="member boxSizing"> <span class="label">团队成员:</span> <span class="value"></span> </div> </div>')),$("#info_tab").fadeIn(300)}}else"全部"==t&&($(".tab").remove(),$(".content").fadeIn(300),get_info($("#infoList > .main")))}function get_record($parent_obj,pagesize,type){$parent_obj.children().remove(),$.ajax({url:apppath+"/dingtalk/feed/list.action",data:{belongId:1,objectId:GetQueryString("accountId"),pagesize:pagesize,pageNo:recordPageNo+1},success:function(data){var oData=eval("("+data+")");if(console.log("跟进记录："+data),1==oData.success)if(0==oData.entity.feeds.length)$parent_obj.css("border",0),console.log("该对象暂无跟进记录");else{if(oData.entity.hasMore){if(0==$("#recordList .more").length){var more=$('<a class="more"></a>');$("#recordList > .top").append(more)}$("#recordList .more").bind("click",function(){$("#nav > .record").addClass("active"),$("#nav > .record").siblings().removeClass("active"),tab($("#nav > .record").attr("href"))})}build_record_list($parent_obj,oData),oData.entity.hasMore&&"tab"==type?($("#loading").remove(),build_end($parent_obj,"加载更多","load_more"),recordPageNo+=1,scroll_load($parent_obj,get_record)):$("#loading").remove()}else oData.entity&&oData.entity.status&&"0000003"==oData.entity.status?location.href=apppath+"/dingtalk/authorized/no.action?"+ddcommparams:myAlert("暂时无法获取数据，请稍后再试")},error:function(){console.log("暂时无法获取数据，请检查您的网络")}})}function build_record_list(t,a){for(var e=a.entity.feeds,o=0;o<e.length;o++){var n,i,c=e[o].user.name,r=e[o].from.name,s=e[o].from.belongId,d=4;e[o].relateBelongId&&(d=Number(e[o].relateBelongId));var l=e[o].relateObjectId,p=e[o].from.id;if(e[o].activityRecord.typeName)n=e[o].activityRecord.typeName;else{p=l,s=d,r=e[o].content;var u=e[o].stream.action;if(1==u)switch(d){case 1:n="创建了公司";break;case 2:n="创建了联系人";break;case 3:n="创建了销售机会"}else if(3==u)switch(d){case 1:n="删除了公司";break;case 2:n="删除了联系人";break;case 3:n="删除了销售机会"}else if(4==u)n="转移了公司";else if(5==u)switch(d){case 1:n="添加了公司";break;case 2:n="添加了联系人";break;case 3:n="添加了销售机会";break;case 4:n="增加了团队成员"}else if(6==u)switch(d){case 1:n="移除了公司";break;case 2:n="移除了联系人";break;case 3:n="移除了销售机会";break;case 4:n="移除了团队成员"}else 11==u?n="改变了商机状态":15==u&&(n="增加了团队成员")}var m=new Date(e[o].createdAt),f=m.getFullYear(),g=m.getMonth()+1;10>g&&(g="0"+g);var b=m.getDate();10>b&&(b="0"+b);var v=m.getHours();10>v&&(v="0"+v);var _=m.getMinutes();10>_&&(_="0"+_);var h=f+"-"+g+"-"+b,y=v+":"+_;if(0==o){var I=$('<div class="day"><em></em><p class="startDate">'+h+'</p><div class="ban"></div></div>');t.append(I)}else{var S=new Date(e[o].createdAt).getFullYear()+"-"+new Date(e[o].createdAt).getMonth()+"-"+new Date(e[o].createdAt).getDate(),k=new Date(e[o-1].createdAt).getFullYear()+"-"+new Date(e[o-1].createdAt).getMonth()+"-"+new Date(e[o-1].createdAt).getDate();if(S!=k){var I=$('<div class="day"><em></em><p class="startDate">'+h+'</p><div class="ban"></div></div>');t.append(I)}}var D=$('<li class="boxSizing"><div class="info"><span class="userName">'+c+'</span><span class="typeName">'+n+':</span><a class="objectName">'+r+'</a><span class="startTime">'+y+"</span></div></li>");if(D.find(".objectName").attr({belongId:s,objectId:p}),p!=GetQueryString("accountId")&&D.find(".objectName").bind("click",function(){var t;if(1==$(this).attr("belongId"))t=apppath+"/dingtalk/account/info.action?"+ddcommparams+"&accountId="+$(this).attr("objectId")+"&from=acc_info&raccountId="+GetQueryString("accountId");else if(2==$(this).attr("belongId"))t=apppath+"/dingtalk/contact/info.action?"+ddcommparams+"&contactId="+$(this).attr("objectId")+"&from=acc_info&raccountId="+GetQueryString("accountId");else{if(3!=$(this).attr("belongId"))return!1;t=apppath+"/dingtalk/opportunity/detail.action?"+ddcommparams+"&opportunityId="+$(this).attr("objectId")+"&from=acc_info&raccountId="+GetQueryString("accountId")}location.href=t}),"电话"==n?D.addClass("phone_bg"):"拜访签到"==n?D.addClass("sign_in_bg"):"快速记录"==n?D.addClass("record_bg"):"创建了公司"==n||"删除了公司"==n||"添加了公司"==n||"移除了公司"==n||"转移了公司"==n?D.addClass("account_bg"):"创建了联系人"==n||"删除了联系人"==n||"添加了联系人"==n||"移除了联系人"==n?D.addClass("contact_bg"):"创建了销售机会"==n||"删除了销售机会"==n||"添加了销售机会"==n||"移除了销售机会"==n||"改变了商机状态"==n?D.addClass("opportunity_bg"):"增加了团队成员"!=n&&"转移了团队成员"!=n&&"移除了团队成员"!=n||D.addClass("member_bg"),e[o].activityRecord.typeName&&e[o].content){i=e[o].content;var x=$('<span class="content_span">'+i+"</span>"),w=$('<div class="content"></div>'),N=$('<em class="triangle"></em>');if(w.append(x),w.append(N),i.length>32){var j=i.substr(0,30)+"...",G=$('<span class="short_content_span">'+j+"</span>");w.append(G),x.css("display","none");var z=0,Q=$('<em class="more"></em>');Q.bind("click",function(){z++,$(this).parent().find(".short_content_span").slideToggle(),$(this).parent().find(".content_span").slideToggle(),$(this).css("transform","rotate("+(90+180*z)+"deg)")}),w.append(Q)}D.append(w)}if(e[o].location.detail){var A=$('<div class="location">'+e[o].location.detail+"</div>");D.append(A)}var T=$('<div class="bottom_border"></div>');D.append(T),t.append(D)}removeBorder()}function removeBorder(){$("#record_tab li").each(function(){$(this).next().hasClass("day")&&$(this).find("div:last-child").css("borderBottom",0)})}function get_contacts($parent_obj,pagesize,type){$.ajax({url:apppath+"/dingtalk/contact/dolist.action",data:{accountId:GetQueryString("accountId"),pagesize:pagesize,orderField:"createdAt",pageNo:contactPageNo},success:function(data){var oData=eval("("+data+")");if(console.log("联系人："+data),1==oData.success)if(0==oData.entity.records.length)$parent_obj.css("border",0),console.log("该对象暂无联系人信息");else{if(oData.entity.totalSize>5){if(0==$("#contactList .more").length){var more=$('<a class="more"></a>');$("#contactList > .top").append(more)}$("#contactList .more").bind("click",function(){$("#nav > .contact").addClass("active"),$("#nav > .contact").siblings().removeClass("active"),tab($("#nav > .contact").attr("href"))})}var totalSize=oData.entity.totalSize;$("#contactList > .top > .title").text("联系人("+totalSize+")"),$("#nav > .contact").text("联系人("+totalSize+")"),build_contact_list($parent_obj,oData),$parent_obj.find("li").length<totalSize&&"tab"==type?($("#loading").remove(),build_end($parent_obj,"加载更多","load_more"),contactPageNo++,scroll_load($parent_obj,get_contacts)):$("#loading").remove()}else oData.entity&&oData.entity.status&&"0000003"==oData.entity.status?location.href=apppath+"/dingtalk/authorized/no.action?"+ddcommparams:myAlert("暂时无法获取数据，请稍后再试")},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function build_contact_list(t,a){for(var e=a.entity.records,o=0;o<e.length;o++){var n=e[o].contactName,i=e[o].post,c=e[o].mobile,r=e[o].id,s=$('<li class="boxSizing"><span class="name">'+n+'</span><span class="post">'+i+'</span><a href="tel:'+c+'" class="tel"></a></li>');s.attr("value",r),s.bind("click",function(){location.href=apppath+"/dingtalk/contact/info.action?"+ddcommparams+"&contactId="+$(this).attr("value")+"&from=acc_info&raccountId="+GetQueryString("accountId")}),s.find(".tel").bind("click",function(t){var a=$(this).parent().attr("value");location.href=apppath+"/dingtalk/activityrecord/create.action?"+ddcommparams+"&belongId=2&objectId="+a+"&activityTypeId="+activeRecordTypeOje.TEL+"&from=acc_info&accountId="+GetQueryString("accountId"),t.stopPropagation()}),t.append(s)}}function get_opportunity($parent_obj,pagesize,type){$.ajax({url:apppath+"/dingtalk/opportunity/dolist.action",data:{accountId:GetQueryString("accountId"),pageNo:opportunityPageNo,pagesize:pagesize,orderField:"updatedAt"},success:function(data){var oData=eval("("+data+")");if(console.log("销售机会："+data),1==oData.success)if(0==oData.entity.records.length)$parent_obj.css("border",0),console.log("该对象暂无销售机会信息");else{if(oData.entity.totalSize>3){if(0==$("#opportunityList .more").length){var more=$('<a class="more"></a>');$("#opportunityList > .top").append(more)}$("#opportunityList .more").bind("click",function(){$("#nav > .chance").addClass("active"),$("#nav > .chance").siblings().removeClass("active"),tab($("#nav > .chance").attr("href"))})}var totalSize=oData.entity.totalSize;$("#opportunityList > .top > .title").text("销售机会("+totalSize+")"),$("#nav > .chance").text("销售机会("+totalSize+")"),build_opportunity($parent_obj,oData),$parent_obj.find("li").length<totalSize&&"tab"==type?($("#loading").remove(),build_end($parent_obj,"加载更多","load_more"),opportunityPageNo++,scroll_load($parent_obj,get_opportunity)):$("#loading").remove()}else 0==oData.success&&(oData.entity&&oData.entity.status&&"0000003"==oData.entity.status?location.href=apppath+"/dingtalk/authorized/no.action?"+ddcommparams:myAlert("暂时无法获取数据，请稍后再试"))},error:function(t,a){myAlert("暂时无法获取数据，请检查您的网络")}})}function build_opportunity(t,a){for(var e=0;e<a.entity.records.length;e++){var o=a.entity.records[e],n=o.saleStageText,i=o.opportunityName,c=o.money,r=o.accountName,s=o.id,d=o.saleStageOrder,l=o.saleStagePercentage,p=$('<li class="boxSizing"><em class="icon jieduan'+d+'"></em><div class="info"><div class="top"><span class="opportunityName">'+i+'</span><span class="Money">'+c+'元</span></div><div class="bot"><p class="accountName">'+r+'</p><p class="jieduan">阶段：'+n+'</p><span class="jieduan_p">'+l+"%</span></div></div></li>");p.attr("value",s),p.bind("click",function(){location.href=apppath+"/dingtalk/opportunity/detail.action?"+ddcommparams+"&opportunityId="+$(this).attr("value")+"&from=acc_info&raccountId="+GetQueryString("accountId")}),t.append(p)}}function get_info($parent_obj){$.ajax({url:apppath+"/dingtalk/account/get.action",data:{accountId:GetQueryString("accountId")},success:function(data){var oData=eval("("+data+")");console.log("详情："+data),1==oData.success?(dataPermission=oData.entity.dataPermission,build_info($parent_obj,oData),ownerName=oData.entity.ownerText,$(".owner .value").text(ownerName),ownerId=oData.entity.ownerId,dataPermission.transfer?change_owner():$(".owner").css("background","none"),dataPermission.update?change_member():$(".member").css("background","none"),get_member(),$(".common .title").text(oData.entity.accountName),accountName=oData.entity.accountName,null!=oData.entity.phone?$("footer > .tel").attr("href","tel:"+oData.entity.phone):$("footer > .tel").attr("href","")):"300032"==oData.errorCode?"opp_info"==GetQueryString("from")?location.href=apppath+"/dingtalk/opportunity/detail.action?"+ddcommparams+"&opportunityId="+GetQueryString("ropportunityId")+"&err=acc_deleted":"con_info"==GetQueryString("from")?location.href=apppath+"/dingtalk/contact/info.action?"+ddcommparams+"&contactId="+GetQueryString("rcontactId")+"&err=acc_deleted":"acc_info"==GetQueryString("from")?location.href=apppath+"/dingtalk/account/info.action?"+ddcommparams+"&accountId="+GetQueryString("raccountId")+"&err=acc_deleted":"index"==GetQueryString("from")&&(GetQueryString("page")?location.href=apppath+"/dingtalk/statics/index.action?"+ddcommparams+"&page="+GetQueryString("page")+"&err=acc_deleted":location.href=apppath+"/dingtalk/statics/index.action?"+ddcommparams):oData.entity&&oData.entity.status&&"0000003"==oData.entity.status?location.href=apppath+"/dingtalk/authorized/no.action?"+ddcommparams:oData.entity&&oData.entity.status&&"0000004"==oData.entity.status?"opp_info"==GetQueryString("from")?location.href=apppath+"/dingtalk/opportunity/detail.action?"+ddcommparams+"&opportunityId="+GetQueryString("ropportunityId")+"&err=acc_noright":"con_info"==GetQueryString("from")?location.href=apppath+"/dingtalk/contact/info.action?"+ddcommparams+"&contactId="+GetQueryString("rcontactId")+"&err=acc_noright":"acc_info"==GetQueryString("from")?location.href=apppath+"/dingtalk/account/info.action?"+ddcommparams+"&accountId="+GetQueryString("raccountId")+"&err=acc_noright":"index"==GetQueryString("from")&&(GetQueryString("page")?location.href=apppath+"/dingtalk/statics/index.action?"+ddcommparams+"&page="+GetQueryString("page")+"&err=acc_noright":location.href=apppath+"/dingtalk/statics/index.action?"+ddcommparams+"&err=acc_noright"):myAlert("暂时无法获取数据，请稍后再试")},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function build_info(t,a){t.children().remove();var e=a.entity.accountName;if(info_atom_build(t,"公司名称",e),e=a.entity.levelText,info_atom_build(t,"公司等级",e),e=a.entity.dbcSelect1Text,info_atom_build(t,"公司状态",e),e=a.entity.industryIdText,info_atom_build(t,"行业",e),e=a.entity.phone,info_atom_build(t,"电话",e),e=a.entity.address,info_atom_build(t,"地址",e),e=a.entity.zipCode,info_atom_build(t,"邮编",e),e=a.entity.fax,info_atom_build(t,"传真",e),e=a.entity.dimDepartText,info_atom_build(t,"所属部门",e),e=a.entity.comment,""!=e){var o=$('<li class="atom commentAtom boxSizing" style="border-top: 1px solid #e3e3e5"><span class="label">备注:</span><span class="value"></span></li>'),n=e,i=$('<span class="content_span">'+n+"</span>"),c=$('<div class="content"></div>');if(c.append(i),n.length>32){var r=n.substr(0,30)+"...",s=$('<span class="short_content_span">'+r+"</span>");c.append(s),i.css("display","none");var d=0,l=$('<em class="more"></em>');l.bind("click",function(){d++,$(this).parent().find(".short_content_span").slideToggle(),$(this).parent().find(".content_span").slideToggle(),$(this).css("transform","rotate("+(90+180*d)+"deg)")}),c.append(l)}o.find(".value").append(c),$(".staff .commentAtom").remove(),$(".staff").append(o)}}function info_atom_build(t,a,e){if(""!=e){if("电话"==a){var o=$('<li class="atom boxSizing"><span class="label">'+a+':</span><a class="value blue" href="tel:'+e+'">'+e+"</a></li>");o.bind("click",function(){location.href=apppath+"/dingtalk/activityrecord/create.action?"+ddcommparams+"&belongId=1&objectId="+GetQueryString("accountId")+"&activityTypeId="+activeRecordTypeOje.TEL+"&from=acc_info&accountId="+GetQueryString("accountId")})}else var o=$('<li class="atom boxSizing"><span class="label">'+a+':</span><span class="value">'+e+"</span></li>");t.append(o)}}function get_member(){$.ajax({type:"post",url:apppath+"/dingtalk/group/relateowner.action",data:{businessId:GetQueryString("accountId"),belongs:1},success:function(data){var oData=eval("("+data+")");if(console.log("团队成员："+data),0==oData.success)myAlert("暂时无法获取数据，请稍后再试");else{memberNameArr=[],memberIdArr=[];for(var i=0;i<oData.entity.users.length;i++)console.log(oData.entity.users.length),memberNameArr.push(oData.entity.users[i].name),memberIdArr.push(oData.entity.users[i].id);$(".member > .value").text(memberNameArr.join(" , "))}},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function change_owner(){$(".staff .owner").bind("click",function(){get_owner_list()})}function get_owner_list(){$.ajax({type:"get",url:apppath+"/dingtalk/xsyuser/pager.action",async:!0,success:function(data){var oData=eval("("+data+")");if(0==oData.success)myAlert("暂时无法获取数据，请稍后再试");else if(1==oData.entity.records.length){var no_contact=$('<div class="no_contact">您的公司下暂时没有其他员工</div>');$("body").append(no_contact),setTimeout(function(){$(".no_contact").remove()},2e3)}else{checkTable("转移给他人");var container=$('<ul id="container" class="container ownerContainer"></ul>');$(".ct").append(container),build_owner_list(container,oData)}}})}function build_owner_list(t,a){for(var e=0;e<a.entity.records.length;e++){if(a.entity.records[e].label==$("#infoList .owner > .value").text())var o=$('<div class="item"><em class="radio active"><i></i></em><span>'+a.entity.records[e].label+"</span></div>");else var o=$('<div class="item"><em class="radio"><i></i></em><span>'+a.entity.records[e].label+"</span></div>");t.append(o)}radio_click(a)}function radio_click(data){$(".ct .item").each(function(index){$(this).bind("click",function(){function sub(){$.ajax({url:apppath+"/dingtalk/account/changeto.action",data:{accountId:GetQueryString("accountId"),ownerid:value},beforeSend:function(){loader()},success:function(data){$(".loaderArea").remove();var oData=eval("("+data+")");setTimeout(function(){ctRemove()},2e3),1==oData.success?($(".owner > .value").text(label),get_record($("#recordList > .main"),5),myDialog("负责人更改成功"),ownerId=value):myAlert("负责人更改失败")},error:function(){$(".loaderArea").remove(),myAlert("暂时无法获取数据，请检查您的网络")}})}$(this).find("em").hasClass("active")||($(this).find("em").addClass("active"),$(this).siblings().find("em").removeClass("active"));var value=data.entity.records[$(this).index()].value,label=data.entity.records[$(this).index()].label;doChangeOwner(label,sub)})})}function change_member(){$(".member").bind("click",function(){get_member_list()})}function get_member_list(){$.ajax({type:"get",url:apppath+"/dingtalk/xsyuser/pager.action",async:!0,success:function(data){var oData=eval("("+data+")");if(0==oData.success)myAlert("暂时无法获取数据，请稍后再试");else if(1==oData.entity.records.length){var no_contact=$('<div class="no_contact">您的公司下暂时没有其他员工</div>');$("body").append(no_contact),setTimeout(function(){$(".no_contact").remove()},2e3)}else{checkTable("修改团队成员");var container=$('<ul id="container" class="container"></ul>');$(".ct").append(container),build_member_list(container,oData)}}})}function build_member_list(t,a){for(var e=$("#infoList .member > .value").text().split(","),o=0;o<a.entity.records.length;o++){var n=a.entity.records[o].label;if(n!=ownerName){var i=$('<li class="item"><em class="checkbox"></em><span>'+n+"</span></li>");i.attr("value",a.entity.records[o].value),t.append(i)}}for(var c=a.entity.records,r=0;r<e.length;r++)for(var o=0;o<c.length;o++)$.trim(e[r])==$(".ct .item").eq(o).find("span").text()&&$(".ct .item").eq(o).find("em").addClass("active");checkbox_click(a),create_confirm(a)}function checkbox_click(t){$(".item").each(function(t){$(this).bind("click",function(){memberChange=!0,$(this).find("em").hasClass("active")?$(this).find("em").removeClass("active"):$(this).find("em").addClass("active")})})}function create_confirm(data){var confirm=$('<button id="confirm" class="confirm">确定</button>');$(".ct").append(confirm),confirm.bind("touchstart",function(){$(this).addClass("touching")}),confirm.bind("touchend",function(){$(this).removeClass("touching")}),confirm.bind("click",function(){var arr_value=[];$(".item").each(function(){$(this).find("em").hasClass("active")&&arr_value.push($(this).attr("value"))}),console.log("团队成员提交"+arr_value.join(",")),$.ajax({type:"post",url:apppath+"/dingtalk/group/setrelateowner.action",data:{businessId:GetQueryString("accountId"),belongs:1,setOwnerIds:arr_value.join(",")},async:!0,success:function(data){var oData=eval("("+data+")");setTimeout(function(){$(".ct").remove(),$("body").css({height:"",overflow:""}),set_title("公司信息")},2e3),1==oData.success?(console.log("团队成员提交成功："+data),myDialog("更改成功"),get_member(),get_record($("#recordList > .main"),5)):myAlert("更改失败")},error:function(t){myAlert("暂时无法获取数据，请检查您的网络")}})})}function footer_phone(){$("footer .tel").bind("click",function(){$(window).scrollTop(0),$.ajax({url:apppath+"/dingtalk/contact/dolist.action",data:{accountId:GetQueryString("accountId"),pageNo:0,pagesize:30},success:function(data){var oData=eval("("+data+")"),item=oData.entity.records,totalSize=oData.entity.totalSize;if(0==totalSize){if(0==$(".no_contact").length){var no_contact=$('<div class="no_contact">暂无联系人可用，请添加联系人</div>');$("body").append(no_contact),setTimeout(function(){$(".no_contact").remove()},2e3)}}else{var shadow=$('<div class="tel_bg"></div>');shadow.bind("click",function(){$(".tel_bg").remove(),$("#mobile_list").remove()}),$("body").append(shadow),$(".tel_bg").css("top",$(document).scrollTop()),$(".tel_bg").fadeIn(200);for(var ul=$('<div id="mobile_list"></div>'),i=0;totalSize>i;i++){console.log(item[i]);var mobile=item[i].mobile,contactName=item[i].contactName,contactId=item[i].id,post=item[i].post,li=$('<a href="tel:'+mobile+'" class="mobile_atom"><div class="left boxSizing"><span class="name">'+contactName+'</span><span class="post">'+post+'</span></div><span class="mobile boxSizing">'+mobile+"</span></a>");li.attr("id",contactId),li.bind("click",function(){location.href=apppath+"/dingtalk/activityrecord/create.action?"+ddcommparams+"&belongId=2&objectId="+$(this).attr("id")+"&activityTypeId="+activeRecordTypeOje.TEL+"&from=acc_info&accountId="+GetQueryString("accountId")}),ul.append(li)}var return_button=$('<li id="rtn_btn">取消</li>');return_button.bind("click",function(){$("body").css({overflow:"",height:""}),$(".tel_bg").remove(),$("#mobile_list").animate({bottom:-$("#mobile_list").height()},300),setTimeout(function(){$("#mobile_list").remove()},300)}),ul.append(return_button),$("body").append(ul),$("body").css({overflow:"hidden",height:"100%"}),$("#mobile_list").bind("touchmove",function(t){t.stopPropagation()}),$("#mobile_list").css({bottom:-$("#mobile_list").height()}),$("#mobile_list").animate({bottom:"0"},300)}}})})}function footer_signin(){$("footer > .signin").bind("click",function(){location.href=apppath+"/dingtalk/activityrecord/qiandao.action?"+ddcommparams+"&belongId=1&objectId="+GetQueryString("accountId")+"&activityTypeId="+activeRecordTypeOje.SIGN_IN+"&from=acc_info&accountId="+GetQueryString("accountId")})}function footer_create_record(){$("footer > .record").bind("click",function(){location.href=apppath+"/dingtalk/activityrecord/create.action?"+ddcommparams+"&belongId=1&objectId="+GetQueryString("accountId")+"&activityTypeId="+activeRecordTypeOje.RECORD+"&from=acc_info&accountId="+GetQueryString("accountId")})}function build_end(t,a,e){var o=$('<div id="'+e+'" class="end_info">'+a+"</div>");t.append(o)}function scroll_load(t,a){var e=document.body.clientHeight;$(window).bind("scroll",function(){$("#load_more").length>0&&$("#load_more").offset().top-$(document).scrollTop()<=e-$("#load_more").height()-50&&($("#load_more").remove(),build_end(t,"加载中…","loading"),a(t,20),$(this).unbind("scroll"),top_nav())})}$(document).bind("ready",function(){top_nav(),nav(),get_record($("#recordList > .main"),5),get_opportunity($("#opportunityList > .main"),3),get_contacts($("#contactList > .main"),5),get_info($("#infoList > .main")),footer_phone(),footer_signin(),footer_create_record(),filter_touch(),$("body").bind("click",function(){$("#area").length>0&&$("#area").remove()}),$("body").bind("touchmove",function(){$("#area").length>0&&$("#area").remove()})}),$(document).ready(function(){set_right("更多",more),control_back(toAccountList);var t="accountDetail";buriedPoint(t)});var accountName,nav_top=$("#topNav").offset().top,recordPageNo=0,contactPageNo=0,opportunityPageNo=0,ownerId,dataPermission,ownerName,memberNameArr=[],memberIdArr=[],memberChange=!1;