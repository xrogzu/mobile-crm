function add_contact(){location.href=apppath+"/dingtalk/contact/add.action?"+ddcommparams+"&from=con_list"}function con_list_back(){"block"==$("#filter_area").css("display")?($("#filter_area").hide(),$(".filter").removeClass("active"),$(".filter").addClass("normal")):location.href=apppath+"/dingtalk/statics/index.action?"+ddcommparams}function filter(){stopScroll($("#filter_area"));var t=0;$("#filter").bind("click",function(){$("#filter_area .content").find(".filter_btn").length<=1&&create_filter(),0==t?($("#filter").addClass("active"),$("#filter").removeClass("normal"),t=1):($("#filter").addClass("normal"),$("#filter").removeClass("active"),t=0),$("#filter_area").toggle()})}function create_filter(){$.ajax({type:"get",url:apppath+"/dingtalk/contact/getCreateDateTypeInfo.action",async:!0,success:function(data){var oData=eval("("+data+")");if(0==oData.success)myAlert("暂时无法获取数据，请稍后再试");else{for(var arrValue=[],i=0;i<oData.entity.length;i++){var fbtn=$('<div class="filter_btn boxSizing">'+oData.entity[i].label+"</div>");arrValue.push(oData.entity[i].value),$("#filter_area .content").append(fbtn)}$("#filter_area .filter_btn").eq(0).addClass("active"),$("#filter_area .filter_btn").each(function(t){$(this).bind("click",function(){pageNo=0,$(this).addClass("active"),$(this).siblings().removeClass("active"),$("#filter_area").hide(),$("#list").children().remove();var t=arrValue[$(this).index()];$(this).index()>0?(arr=[],create_contact_list(t)):(arr=[],create_contact_list())})})}},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function create_contact_list(createDateType){$.ajax({type:"get",url:apppath+"/dingtalk/contact/dolist.action",data:{pageNo:pageNo,pagesize:pageSize,createDateType:createDateType},async:!0,success:function(data){var oData=eval("("+data+")");if(0==oData.success)oData.entity&&oData.entity.status&&"0000003"==oData.entity.status?location.href=apppath+"/dingtalk/authorized/no.action?"+ddcommparams:myAlert("暂时无法获取数据，请稍后再试");else{for(var i=0;i<oData.entity.records.length;i++)arr.push(oData.entity.records[i]);if(0==oData.entity.records.length){var empty=$('<div class="empty">暂无相关数据</div>');$("#list").append(empty)}else build_list(arr);$("#list").find(".con").length<oData.entity.totalSize?($("#loading").remove(),build_end("加载更多","load_more"),pageNo+=1,scroll_load()):$("#loading").remove()}},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function scroll_load(){$("#content").bind("scroll",function(){$("#load_more").length>0&&$("#load_more").offset().top<=$(window).height()-$("#load_more").height()&&($("#load_more").remove(),build_end("加载中…","loading"),create_contact_list())})}function build_list(t){for(var a,e=pageNo*pageSize;e<t.length;e++){a=/(?!^(\d+|[~!@#$%^&*?]+)$)^[\w~!@#$%\^&*?]+$/.test(t[e].contactName_py.substr(0,1))?t[e].contactName_py.substr(0,1):"#";var i=icon_word(t,e);if(0==e){var o=$("<li></li>"),n=$('<div class="top boxSizing" id="'+a.toUpperCase()+'">'+a.toUpperCase()+"</div>");o.append(n)}else if(a!=t[e-1].contactName_py.substr(0,1)&&!/^\d$/.test(t[e].contactName_py.substr(0,1))){var o=$("<li></li>"),n=$('<div class="top boxSizing" id="'+a.toUpperCase()+'">'+a.toUpperCase()+"</div>");o.append(n)}$("#list").append(o);var c=document.createElement("div");$(c).attr("value",t[e].id),c.className="con boxSizing";var r=t[e].contactName,s=t[e].post,l=t[e].accountName,d=t[e].mobile;console.log(r),$(c).append($('<div class="pic boxSizing"><i class="cir">'+i+'</i></div><div class="info boxSizing"> <span class="name">'+r+'</span> <span class="job">'+s+'</span><span class="company boxSizing">'+l+'</span><a class="tel" href="tel:'+d+'"></a></div>')),$("#list > li:last").append(c),$(c).find(".tel").bind("click",function(t){var a=$(this).parent().parent().attr("value");location.href=apppath+"/dingtalk/activityrecord/create.action?"+ddcommparams+"&belongId=2&objectId="+a+"&activityTypeId="+activeRecordTypeOje.TEL+"&from=con_info&contactId="+a,t.stopPropagation()}),set_cir_color($(c).find(".cir"))}con_click(t)}function icon_word(t,a){return/^[\u4e00-\u9fa5]+$/.test(t[a].contactName.substr(0,1))?t[a].contactName.substr(-2):t[a].contactName.substr(0,2)}function con_click(t){$("#list .con").each(function(a){$(this).click(function(){location.href=apppath+"/dingtalk/contact/info.action?"+ddcommparams+"&contactId="+$(this).attr("value"),local_set(t[a].id,t[a].contactName,2)})})}function local_set(t,a,e){if(1==e||2==e){var i={id:t,name:a,kindle:e};if(localStorage.getItem(userId)){var o=JSON.parse(localStorage.getItem(userId));if(o.accountHistory){for(var n=0;n<o.accountHistory.length;n++)o.accountHistory[n].id==t&&o.accountHistory.remove(n);o.accountHistory.push(i)}else var o={accountHistory:[i]}}else var o={accountHistory:[i]}}else if(3==e){var i={id:t,name:a};if("undefined"!=localStorage.getItem(userId)){var o=JSON.parse(localStorage.getItem(userId));if(o.opportunityHistory){for(var n=0;n<o.opportunityHistory.length;n++)o.opportunityHistory[n].id==t&&o.opportunityHistory.remove(n);o.opportunityHistory.push(i)}else var o={opportunityHistory:[i]}}else var o={opportunityHistory:[i]}}localStorage.setItem(userId,JSON.stringify(o))}function build_end(t,a){var e=$('<div id="'+a+'" class="end_info">'+t+"</div>");$("#list").append(e)}$(document).bind("ready",function(){$("#txt").bind("click",function(){location.href=apppath+"/dingtalk/account/search.action?"+ddcommparams}),create_contact_list(),filter(),set_right("新建",add_contact),$("#company").bind("click",function(){location.href=apppath+"/dingtalk/account/list.action?"+ddcommparams}),$("#search").bind("click",function(){location.href=apppath+"/dingtalk/account/search.action?"+ddcommparams})}),dd.ready(function(){control_back(con_list_back);var t="contactList";buriedPoint(t)});var pageNo=0,pageSize=20,arr=[],userId=xsyUser.id;