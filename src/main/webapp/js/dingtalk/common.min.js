function footerSkip(){$("footer .account").bind("click",function(){location.href=apppath+"/dingtalk/account/list.action?"+ddcommparams}),$("footer .opportunity").bind("click",function(){location.href=apppath+"/dingtalk/opportunity/list.action?"+ddcommparams}),$("footer .service").bind("click",function(){location.href=apppath+"/dingtalk/serveice/index.action?"+ddcommparams}),$("footer .index").bind("click",function(){location.href=apppath+"/dingtalk/statics/index.action?"+ddcommparams})}function errInfo(){GetQueryString("err")&&("acc_deleted"==GetQueryString("err")?myDialog("该公司已被删除","without"):"con_deleted"==GetQueryString("err")?myDialog("该联系人已被删除","without"):"opp_deleted"==GetQueryString("err")?myDialog("该销售机会已被删除","without"):"acc_noright"==GetQueryString("err")?myDialog("您无权查看该公司","without"):"con_noright"==GetQueryString("err")?myDialog("您无权查看该联系人","without"):"opp_noright"==GetQueryString("err")&&myDialog("您无权查看该销售机会","without"))}function stopScroll(t){function n(t){t.preventDefault()}t.bind("touchmove",n,!1)}function control_back(t){function n(n){n.preventDefault(),t()}var i=navigator.userAgent,o=i.indexOf("Android")>-1||i.indexOf("Adr")>-1,e=!!i.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);o?document.addEventListener("backbutton",function(t){n(t)},!1):e&&dd.biz.navigation.setLeft({control:!0,onSuccess:function(n){t()},onFail:function(t){}})}function set_back(t){var n=navigator.userAgent,i=n.indexOf("Android")>-1||n.indexOf("Adr")>-1,o=!!n.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);i?document.addEventListener("backbutton",function(n){n.preventDefault(),location.href=t},!1):o&&dd.biz.navigation.setLeft({show:!0,control:!0,showIcon:!0,onSuccess:function(n){location.href=t},onFail:function(t){}})}function set_cir_color(t){null==t.color&&(t.color=arr_color[Math.floor(Math.random()*arr_color.length)]),t.css("backgroundColor",t.color)}function set_title(t){dd.ready(function(){dd.biz.navigation.setTitle({title:t,onSuccess:function(t){},onFail:function(t){}})})}function remove_rTop(){dd.ready(function(){dd.biz.navigation.setRight({control:!0,show:!1})})}function set_right(t,n){dd.ready(function(){dd.biz.navigation.setRight({control:!0,text:t,onSuccess:function(){n()}})})}function checkTable(t){$(".ct").remove();var n=$('<div class="ct"></div>');$("body").append(n),$(window).scrollTop(0),$("body").css({height:"100%",overflow:"hidden"}),set_title(t),remove_rTop()}function textarea_num(){$("#num").text($("#textarea").val().length+"/1000"),$("#textarea").bind("input",function(){$(this).val().length>1e3&&$(this).val($(this).val().substr(0,1e3)),$("#num").text($(this).val().length+"/1000")})}function reg_exp(t,n,i){t.bind("click",function(){$(this).css("background","")}),t.bind("blur",function(){confirm_reg(t,n,i)})}function confirm_reg(t,n,i){n.test(t.val())||add_warn(t,i)}function rtn_reg(t,n){return!!n.test(t.val())}function GetQueryString(t){var n=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(n);return null!=i?decodeURI(i[2]):null}function btn_color_adjust(){$("button").each(function(){"点击选择"!=$(this).html()?$(this).addClass("active"):$(this).removeClass("active")})}function input_color_adjust(){$("input").each(function(){$(this).bind("input",function(){null!=$(this).val()?$(this).addClass("active"):$(this).removeClass("active")})}),$("textarea").each(function(){$(this).bind("input",function(){console.log("1"),null!=$(this).val()?$(this).addClass("active"):$(this).removeClass("active")})})}function add_warn(t,n){t.addClass("warn");var i=$('<div class="warning"><span>'+n+"</span></div>");t.parent().parent().css({marginBottom:"70px"}),t.parent().append(i),t.bind("click",function(){remove_warn(t)})}function remove_warn(t){t.removeClass("warn"),t.parent().parent().css({marginBottom:"0px"}),t.parent().find(".warning").remove()}function btn_touch_style(){$(".confirm").bind("touchstart",function(){$(this).addClass("touching")}),$(".confirm").bind("touchend",function(){$(this).removeClass("touching")})}function create_record(data,$button){function doWindowLocationChange(){var t=GetQueryString("from");"acc_info"==t?location.href=apppath+"/dingtalk/account/info.action?"+ddcommparams+"&accountId="+GetQueryString("accountId"):"con_info"==t?location.href=apppath+"/dingtalk/contact/info.action?"+ddcommparams+"&contactId="+GetQueryString("contactId"):"opp_info"==t&&(location.href=apppath+"/dingtalk/opportunity/detail.action?"+ddcommparams+"&opportunityId="+GetQueryString("opportunityId"))}$.ajax({url:apppath+"/dingtalk/activityrecord/docreate.action",contentType:"application/x-www-form-urlencoded",data:data,beforeSend:function(){$button.attr("disabled",!0),loader()},success:function(str){$(".loaderArea").remove();var oData=eval("("+str+")");if(1==oData.success){if(data.activityTypeId==activeRecordTypeOje.SIGN_IN){var buriedPointType="Sign";buriedPoint(buriedPointType)}else{var buriedPointType="activityRecordAdd";buriedPoint(buriedPointType)}myDialog("创建成功"),setTimeout(function(){doWindowLocationChange()},2e3)}else"0000002"==oData.entity.status?(myAlert("创建失败，不能包含表情符"),$button.removeAttr("disabled")):oData.entity&&oData.entity.status&&"0000003"==oData.entity.status?location.href=apppath+"/dingtalk/authorized/no.action?"+ddcommparams:($button.removeAttr("disabled"),myAlert("创建失败"))},error:function(t,n,i){$(".loaderArea").remove(),$button.removeAttr("disabled"),myAlert("暂时无法获取数据，请检查您的网络")}})}function myAlert(t){$(".UPS").remove();var n=$('<div class="commonShadow UPS"></div>'),i=$('<div class="alert"><span>'+t+"</span><div>确定</div></div>");i.find("div").bind("click",function(){$(this).parent().parent().remove()}),n.append(i),$("body").append(n),stopScroll($(".commonShadow")),stopScroll($(".alert"))}function myDialog(t,n){if($(".UPS").remove(),"without"==n)var i=$('<div class="dialog_without_pic UPS">'+t+"</div>");else var i=$('<div class="dialog UPS">'+t+"</div>");$("body").append(i),setTimeout(function(){$(".dialog").remove(),$(".dialog_without_pic").remove()},2e3)}function time_out_location(t){setTimeout(function(){location.href=t},2e3)}function myChoose(t,n){$(".UPS").remove();var i=$('<div class="chooseShadow UPS"><div class="dia"><p class="boxSizing">确定放弃操作并退出吗？</p><div class="chooseBtn"><div class="n">取消</div><div class="y boxSizing">确认</div></div></div></div>');$("body").append(i),$(".dia").css({top:"200px",left:($(window).width()-$(".dia").width())/2}),$(".y").bind("click",function(){$(".chooseShadow").remove(),""!=t?location.href=t:n&&n()}),$(".n").bind("click",function(){$(".chooseShadow").remove()})}function input_adjust(){$("input").bind("blur",function(){var t=$(this).val();$(this).val(t.trim())})}function build_common_list(url,$container,nullInfo,build_unit,scrollFunc){$(window).scrollTop(0),$.ajax({url:url,data:obj,success:function(data){console.log(data);var oData=eval("("+data+")");if(1==oData.success){var len=oData.entity.totalSize,sEnd;if(0==len){$container.children().remove();var $list=$('<div class="list">'+nullInfo+"</div>");$list.css({width:"100%",lineHeight:"90px",fontSize:"30px",textAlign:"center"}),$container.append($list)}else{sEnd=len-pageNo*pageSize>pageSize?pageSize:len-pageNo*pageSize;for(var i=0;sEnd>i;i++)build_unit(oData,$container,i);$container.children().length<len&&$container.append($('<div id="load_more" class="end_info">加载更多</div>')),obj.pageNo++,pageNo++,$("#loading").remove(),scrollFunc()}}else oData.entity&&oData.entity.status&&"0000003"==oData.entity.status?location.href=apppath+"/dingtalk/authorized/no.action?"+ddcommparams:myAlert("暂时无法获取数据，请稍后再试")},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function loader(){var t=$('<div class="loaderArea"><div class="loader"></div><span>加载中…</span></div>');$("body").append(t)}function buriedPoint(buriedPointType){dd.biz.util.ut({key:"open_micro_general_operat",value:{corpId:_config.corpId,agentId:_config.agentId,type:buriedPointType},onSuccess:function(){console.log("埋点成功:"+buriedPointType)},onFail:function(err){var oErr=eval("("+err+")");console.log("埋点失败："),console.log(oErr)}})}function doChangeOwner(t,n){var i=$('<div class="cOwnerShadow"><div class="cOwner boxSizing"><div class="topInfo boxSizing"><p><span class="word">确认将联系人变更为:"</span><span class="ownerName">'+t+'</span><span class="word">",</span></p><p>变更后将失去相关权限</p></div><div class="botBtn"><div class="no boxSizing">取消</div><div class="yes boxSizing">确认</div></div></div></div>');i.find(".yes").bind("click",function(){i.remove(),n()}),i.find(".no").bind("click",function(){i.remove()}),$("body").append(i)}$(document).bind("ready",function(){footerSkip(),errInfo()}),dd.ready(function(){dd.ui.webViewBounce.disable();var t=document.getElementsByTagName("head")[0],n=t.getElementsByTagName("title")[0].innerHTML;dd.biz.navigation.setTitle({title:n,onSuccess:function(t){},onFail:function(t){}})});var arr_color=["#78c06e","#f65e8d","#f6bf26","#3bc2b5","#5c6bc0","#f65e5e","#5e97f6","#9a89b9","#bd84cd","#6bb5ce","#a1887f","#ff943e","#5ec9f6","#c5cb63","#ff8e6b","#78919d"];Array.prototype.indexOf=function(t){for(var n=0;n<this.length;n++)if(this[n]==t)return n;return-1},Array.prototype.remove=function(t){var n=this.length;t>=0&&n>t&&this.splice(t,1)},jQuery.fn.extend({autoHeight:function(){function t(t){var n=jQuery(t);return n.css({height:n.attr("_initAdjustHeight"),"overflow-y":"hidden"}).height(t.scrollHeight)}return this.each(function(){var n=jQuery(this);n.attr("_initAdjustHeight")||n.attr("_initAdjustHeight",n.outerHeight()),t(this),t(this).on("input",function(){t(this)})})}}),String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};