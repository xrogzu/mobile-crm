function keyboard(){dd.ready(function(){dd.ui.input.plain({placeholder:"请输入公司或联系人名称",text:"",onSuccess:function(t){$("#search").find("input").val(t.text),input_search()},onFail:function(){}})})}function input_delete(){""==$("#search").find("input").val()?$("#search").find(".delete_icon").hide():$("#search").find(".delete_icon").show(),$("#search").find(".delete_icon").bind("click",function(){$(this).hide(),$("#search").find("input").val(""),$("#content>.list").remove(),$(".dialog").remove(),show_history()})}function list_top(){$(window).bind("scroll",function(){var t=$("#acc_area").offset().top-$(document).scrollTop();88>=t?($("#account_top").css({position:"fixed",top:"88px"}),$("#acc_area").css({paddingTop:$("#account_top").height()+"px"})):($("#account_top").css({position:"static"}),$("#acc_area").css({paddingTop:"0px"}));var e=$("#con_area").offset().top-$(document).scrollTop();e<=88+$("#account_top").height()?$("#account_top").css({position:"absolute",top:$("#con_area").offset().top-$("#account_top").height()-1+"px"}):$("#account_top").css({top:"88px"}),88>=e?($("#contact_top").css({position:"fixed",top:"88px"}),$("#con_area").css({paddingTop:$("#contact_top").height()+"px"})):($("#contact_top").css({position:"static"}),$("#con_area").css({paddingTop:"0px"}))})}function search(){show_history(),$("#txt").bind("input",function(){input_search()})}function input_search(){input_delete(),val=$("#txt").val()," "==val.substr(0,1)&&(val=val.trim()),""==val?($(".list").remove(),$(".dialog").remove(),show_history()):show_word(val)}function show_history(){if($("#content").children().remove(),"undefined"!=localStorage.getItem(userId)){var t=JSON.parse(localStorage.getItem(userId));console.log(t),null==t?create_history_null():0!=t.accountHistory.length?create_history_list(t):create_history_null()}else create_history_null()}function create_history_list(t){if(t.accountHistory.length<=20){for(var e=t.accountHistory.length-1;e>=0;e--)build_history_list(t,e);create_delete()}else{for(var e=t.accountHistory.length-1;e>=t.accountHistory.length-20;e--)build_history_list(t,e);create_delete()}}function build_history_list(t,e){var a=document.createElement("div");a.className="boxSizing history_list";var c=t.accountHistory[e].name,n=t.accountHistory[e].id,o=t.accountHistory[e].kindle;1==o?($(a).append($('<em class="account_pic"></em>')),$(a).bind("click",function(){location.href=apppath+"/dingtalk/account/info.action?"+ddcommparams+"&accountId="+n})):($(a).append($('<em class="contact_pic"></em>')),$(a).bind("click",function(){location.href=apppath+"/dingtalk/contact/info.action?"+ddcommparams+"&contactId="+n})),$(a).append($('<span class="name">'+c+"</span>"));var i=document.createElement("div");i.innerHTML='<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NDA5MDMwNDRCMkU5MTFFNUE4MDNFMkU5NkI5N0FEOEMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NDA5MDMwNDVCMkU5MTFFNUE4MDNFMkU5NkI5N0FEOEMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMTRGRjgyMUIyRTUxMUU1QTgwM0UyRTk2Qjk3QUQ4QyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMTRGRjgyMkIyRTUxMUU1QTgwM0UyRTk2Qjk3QUQ4QyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Prom4REAAADHSURBVHjanNVNCoMwEAXgydAb9CJ21QvYVb2uK91rwUUPYs9gZ2ACIeTnJQNv48gHCQ91+3ZsROQkb8mP+uYumSUXG/aULLbowVYznIKT5Ct5dKAeG8yYFDwlrwBdQTTG1DjZliE6AGgS0wUHL6FoFotBBC1iKbCEVjGdW+aOPLoEKNWwEphCqYbljhzOBT6DwPjOoEpxQ8+gnnJDz6CecktpEZRbSoug3IhVUe7Aiijbl9ZjI4jl0Nkf+WNYzy/Ao2rQX4ABAORFZTtFQ9/RAAAAAElFTkSuQmCC"/>',i.className="exit",$(i).bind("click",function(){t.accountHistory.remove(e),localStorage.setItem(userId,JSON.stringify(t)),$(a).remove(),0==$("#content").find(".history_list").length&&($("#content > .clear").remove(),create_history_null())}),a.appendChild(i),a.href=n,$("#content").append(a)}function create_delete(){var t=document.createElement("div");t.innerHTML="清除全部历史记录",t.className="clear",t.onclick=function(){var t=JSON.parse(localStorage.getItem(userId));t.accountHistory=[],localStorage.setItem(userId,JSON.stringify(t)),$("#content > .history_list").remove(),$("#content > .clear").remove(),create_history_null()},$("#content").append(t)}function create_history_null(){var t=document.createElement("div");t.innerHTML="暂无历史记录",t.className="null",$("#content").append(t)}function show_word(t){$("#content").children().remove(),create_word_list(t)}function create_word_list(val){$.ajax({type:"get",url:apppath+"/dingtalk/account/dosearch.action",async:!0,data:{searchName:val,pageNo:0,pagesize:pageSize},success:function(data){oData=eval("("+data+")"),0==oData.entity.accounts.success||0==oData.entity.contacts.success?myAlert("暂时无法获取数据，请稍后再试"):($(".dialog").remove(),build_word_list(oData))},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function build_word_list(t){$("#content>.list").remove(),accLength=t.entity.accounts.entity.totalSize,conLength=t.entity.contacts.entity.totalSize;t.entity.accounts.entity.records.length,t.entity.contacts.entity.records.length;if(accLength>0){var e=$('<div id="acc_area" class="boxSizing"></div>'),a=$('<div id="account_top" class="boxSizing top"><img src="../../images/dingtalk/2x/common/account.png"/><sapn>公司</sapn></div>');e.append(a)}if($("#acc_area").length>0&&$("#acc_area").remove(),$("#content").append(e),create_acc_list(0,5,t),conLength>0){var c=$('<div id="con_area" class="boxSizing"></div>'),a=$('<div id="contact_top" class="boxSizing top"><img src="../../images/dingtalk/2x/common/contact.png"/><sapn>联系人</sapn></div>');c.append(a)}if($("#con_area").length>0&&$("#con_area").remove(),$("#content").append(c),create_con_list(0,5,t),0==conLength&&0==accLength){$("#content>.list").remove();var n=document.createElement("div");n.style.cssText="width:100%;padding-left:10px;line-height:88px;font-size:30px;text-align:center;",n.className="list",n.innerHTML="无相关公司或联系人",$("#content").append(n)}}function create_acc_list(start,end,obj){if(null!=obj){var new_data=obj;build_acc_list(start,end,new_data)}else $.ajax({type:"get",url:apppath+"/dingtalk/account/dosearch.action",async:!0,data:{searchName:val,pageNo:acc_pageNo,pagesize:pageSize},success:function(data1){var new_data=eval("("+data1+")");0==new_data.entity.accounts.success||0==new_data.entity.contacts.success?myAlert("暂时无法获取数据，请稍后再试"):($(".dialog").remove(),build_acc_list(start,end,new_data))},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function build_acc_list(t,e,a){e>a.entity.accounts.entity.records.length&&(e=a.entity.accounts.entity.records.length);for(var c=t;e>c;c++){var n=document.createElement("div"),o=a.entity.accounts.entity.records[c].accountName,i=new RegExp(val,"g"),s=a.entity.accounts.entity.records[c].id;n.href=s,n.name=o,o=o.replace(i,"<span class='blue'>"+val+"</span>"),n.innerHTML=o,n.className="boxSizing word_list",n.addEventListener("click",function(){local_set(this.href,this.name,1),location.href=apppath+"/dingtalk/account/info.action?"+ddcommparams+"&accountId="+this.href}),$("#acc_area").append(n)}$("#acc_area > .word_list").length<accLength?5==$("#acc_area > .word_list").length?acc_first_more(oData):create_acc_more():accLength>5&&create_acc_less()}function acc_first_more(t){var e=$('<div class="show_more">查看更多</div>');$("#acc_area").append(e),e.bind("click",function(){$(this).remove(),create_acc_list(5,30,t)})}function create_acc_more(){var t=$('<div class="show_more">查看更多</div>');$("#acc_area").append(t),t.bind("click",function(){$(this).remove(),acc_pageNo+=1,create_acc_list(0,30)})}function create_acc_less(){var t=$('<div class="show_less">收起</div>');$("#acc_area").append(t),t.bind("click",function(){$(this).remove(),$("#acc_area>.word_list").each(function(t){$(this).index()>5&&$(this).remove()}),acc_pageNo=0,acc_first_more(oData)})}function create_con_list(start,end,obj){if(null!=obj){var new_data=obj;build_con_list(start,end,new_data)}else $.ajax({type:"get",url:apppath+"/dingtalk/account/dosearch.action",async:!0,data:{searchName:val,pageNo:con_pageNo,pagesize:pageSize},success:function(data1){var new_data=eval("("+data1+")");0==new_data.entity.accounts.success||0==new_data.entity.contacts.success?myAlert("暂时无法获取数据，请稍后再试"):($(".dialog").remove(),build_con_list(start,end,new_data))},error:function(){myAlert("暂时无法获取数据，请检查您的网络")}})}function build_con_list(t,e,a){e>a.entity.contacts.entity.records.length&&(e=a.entity.contacts.entity.records.length);for(var c=t;e>c;c++){var n=document.createElement("div"),o=a.entity.contacts.entity.records[c].contactName,i=new RegExp(val,"g");o=o.replace(i,"<span class='blue'>"+val+"</span>");var s=a.entity.contacts.entity.records[c].id;n.innerHTML=o,n.className="boxSizing word_list",n.href=s,n.name=o,n.addEventListener("click",function(){console.log(this.href),local_set(this.href,this.name,2),location.href=apppath+"/dingtalk/contact/info.action?"+ddcommparams+"&contactId="+this.href}),$("#con_area").append(n)}$("#con_area > .word_list").length<conLength?5==$("#con_area > .word_list").length?con_first_more(oData):create_con_more():conLength>5&&create_con_less()}function con_first_more(t){var e=$('<div class="show_more">查看更多</div>');$("#con_area").append(e),e.bind("click",function(){$(this).remove(),create_con_list(5,30,t)})}function create_con_more(){var t=$('<div class="show_more">查看更多</div>');$("#con_area").append(t),t.bind("click",function(){$(this).remove(),con_pageNo+=1,create_con_list(0,30)})}function create_con_less(){var t=$('<div class="show_less">收起</div>');$("#con_area").append(t),t.bind("click",function(){$(this).remove(),$("#con_area>.word_list").each(function(t){$(this).index()>5&&$(this).remove()}),con_pageNo=0,con_first_more(oData)})}function back(){$("#back").bind("click",function(){history.go(-1)})}function local_set(t,e,a){if(1==a||2==a){var c={id:t,name:e,kindle:a};if(localStorage.getItem(userId)){var n=JSON.parse(localStorage.getItem(userId));if(n.accountHistory){for(var o=0;o<n.accountHistory.length;o++)n.accountHistory[o].id==t&&n.accountHistory.remove(o);n.accountHistory.push(c)}else n.opportunityHistory=[c]}else var n={accountHistory:[c]}}else if(3==a){var c={id:t,name:e};if(localStorage.getItem(userId)){for(var n=JSON.parse(localStorage.getItem(userId)),o=0;o<n.opportunityHistory.length;o++)n.opportunityHistory[o].id==t&&n.opportunityHistory.remove(o);n.opportunityHistory.push(c)}else var n={opportunityHistory:[c]}}localStorage.setItem(userId,JSON.stringify(n))}$(document).bind("ready",function(){search(),input_delete(),back(),remove_rTop()}),dd.ready(function(){var t="ACSearch";buriedPoint(t)});var val=null,acc_pageNo=0,con_pageNo=0,pageSize=30,oData,accLength,conLength,userId=xsyUser.id;