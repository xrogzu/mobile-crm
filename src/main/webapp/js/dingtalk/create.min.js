function backRemind(){0==$(".chooseShadow").length&&(activityTypeId==activeRecordTypeOje.TEL&&"拨打了一个电话"!=$("textarea").val()?myChoose():activityTypeId==activeRecordTypeOje.RECORD&&""!=$("textarea").val()?myChoose():history.back())}function myChoose(){var e=$('<div class="chooseShadow"><div class="dia"><p class="boxSizing">确定放弃操作并退出吗？</p><div class="chooseBtn"><div class="n">取消</div><div class="y boxSizing">确认</div></div></div></div>');$("body").append(e),$(".dia").css({top:"200px",left:($(window).width()-$(".dia").width())/2}),$(".y").bind("click",function(){$(".chooseShadow").remove(),history.go(-1)}),$(".n").bind("click",function(){$(".chooseShadow").remove()})}function confirm(){$("#confirm").bind("click",function(){var e=$("#textarea").val();if(""==e)myAlert("请填写备注");else{var t={content:e,belongId:belongId,activityTypeId:activityTypeId,objectId:objectId};create_record({activityRecordDtoString:JSON.stringify(t)},$("#confirm"))}})}function set_relevance(e){var t=["","公司","联系人","销售机会","","","市场活动","","","","","销售线索"],a=t[belongId];$("#relevance > .value").text(a+"-"+e),activityTypeId==activeRecordTypeOje.TEL&&($("textarea").val("拨打了一个电话"),$("#num").text($("textarea").val().length+"/1000"))}function getObjectName(){switch(belongId){case 1:$.ajax({url:apppath+"/dingtalk/account/get.action",data:{accountId:objectId},success:function(data){var oData=eval("("+data+")"),objectName=oData.entity.accountName;set_relevance(objectName)}});break;case 2:$.ajax({url:apppath+"/dingtalk/contact/get.action",data:{contactId:objectId},success:function(data){console.log(data);var oData=eval("("+data+")"),objectName=oData.entity.contactName;set_relevance(objectName)}});break;case 3:$.ajax({url:apppath+"/dingtalk/opportunity/get.action",data:{opportunityId:objectId},success:function(data){var oData=eval("("+data+")"),objectName=oData.entity.opportunityName;set_relevance(objectName)}})}}$(document).bind("ready",function(){getObjectName(),$("textarea").autoHeight(),remove_rTop(),textarea_num(),confirm(),btn_touch_style()}),dd.ready(function(){control_back(backRemind)});var belongId=Number(GetQueryString("belongId")),objectId=GetQueryString("objectId"),activityTypeId=GetQueryString("activityTypeId"),source=0,u=navigator.userAgent,isAndroid=u.indexOf("Android")>-1||u.indexOf("Adr")>-1,isiOS=!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);isAndroid?source=1:isiOS&&(source=2);