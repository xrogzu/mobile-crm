function back(){""==$("#textarea").val()&&""==$("input").val()?location.href=apppath+"/dingtalk/serveice/index.action?"+ddcommparams:0==$(".chooseShadow").length?myChoose(apppath+"/dingtalk/serveice/index.action?"+ddcommparams):$(".chooseShadow").remove()}function confirm(){$("#send").bind("touchstart",function(){$(this).addClass("touching")}),$("#send").bind("touchend",function(){$(this).removeClass("touching")}),$("#send").bind("click",function(){rtn_reg($("#textarea"),reg_opinion)&&rtn_reg($(".contactWay input"),reg_tel)?$.ajax({url:apppath+"/dingtalk/feedback/add.action",data:{content:$("#textarea").val(),contactWay:$(".contactWay input").val(),device:device},beforeSend:function(){$(this).attr("disabled",!0),loader()},success:function(data){$(".loaderArea").remove();var oData=eval("("+data+")");if(1==oData.success){var buriedPointType="Suggest";buriedPoint(buriedPointType),myDialog("提交成功"),time_out_location(apppath+"/dingtalk/serveice/index.action?"+ddcommparams)}else"0000002"==oData.entity.status?(myAlert("提交失败，不能包含表情符"),$button.removeAttr("disabled")):oData.entity&&oData.entity.status&&"0000003"==oData.entity.status?location.href=apppath+"/dingtalk/authorized/no.action?"+ddcommparams:(myAlert("提交失败"),$(this).removeAttr("disabled"))},error:function(){$(".loaderArea").remove(),myAlert("暂时无法获取数据，请检查您的网络","without"),$(this).removeAttr("disabled")}}):(""==$("#textarea").val()&&myAlert("请填写反馈内容"),confirm_reg($(".contactWay input"),reg_tel,"联系方式格式错误"))})}function confirm_reg(t,a,e){a.test(t.val())||add_warn(t,e)}function add_warn(t,a){t.addClass("warn");var e=$('<div class="warning"><span>'+a+"</span></div>");t.parent().css({marginBottom:"74px"}),t.parent().append(e),t.bind("click",function(){remove_warn(t)})}function remove_warn(t){t.removeClass("warn"),t.parent().css({marginBottom:"0px"}),t.parent().find(".warning").remove()}function textarea_num(){$("#num").text($("#textarea").val().length+"/300"),$("#textarea").bind("input",function(){$(this).val().length>300&&$(this).val($(this).val().substr(0,300)),$("#num").text($(this).val().length+"/300")})}$(document).bind("ready",function(){textarea_num(),confirm()}),dd.ready(function(){remove_rTop(),control_back(back)});var reg_opinion=/^.{1,300}$/,reg_tel=/^[a-zA-Z0-9@.]{0,200}$/,device=3,u=navigator.userAgent,isAndroid=u.indexOf("Android")>-1||u.indexOf("Adr")>-1,isiOS=!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);isAndroid?device=2:isiOS&&(device=1);